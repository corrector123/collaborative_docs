import{_ as D,r as p,l as L,a as h,o as u,c as m,b as t,d,e as v,F as I,i as $,t as c,u as x,p as F,v as n,E as A,x as g,n as B,m as G,G as U,H as j,I as J}from"./index-2dae8f78.js";import{G as O,A as H,R as q}from"./index-74b89282.js";import"./index-1adbd7d5.js";const K={class:"message-centre"},Q={class:"message-list"},W={class:"message-header"},X={class:"message-actions"},Y={class:"message-items"},Z=["onClick"],ee={class:"message-item-header"},se={class:"message-meta"},te={class:"message-sender"},ae={class:"message-date"},oe={class:"message-actions"},ne={class:"message-preview"},le={key:0,class:"message-detail"},ie={class:"detail-header"},ce={class:"detail-actions"},re={class:"detail-meta"},de={class:"sender"},_e={class:"date"},ue={class:"detail-content"},me={key:1,class:"message-empty"},ve={__name:"index",setup(ge){const f=s=>JSON.parse(JSON.stringify(s)),r=p([]);p(0);const a=p(null),i=p([]),k=s=>s?new Date(s).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",P=s=>{a.value=f(s),s.is_read||(s.is_read=!0,b(s.message_id))},y=async()=>{try{const s=await O();if(console.log("API原始响应:",s),s.code===200){const e=f(s.data.messages);console.log("去除Proxy后的数据:",e),r.value=e,console.log("最终的messageList:",r.value)}else n.error(s.message||"获取消息失败")}catch(s){console.error("获取消息失败:",s),n.error("获取消息列表失败")}},V=async s=>{try{await A.confirm("确定接受此邀请吗？","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"success"});const e=a.value.file_id,l=a.value.sender_id,_=await H({userid:0,targetId:l,file_id:e});_.code===200?(n.success("已接受邀请"),s.is_read=!0,await y()):n.error(_.message||"操作失败")}catch(e){e!=="cancel"&&(console.error("接受邀请失败:",e),n.error("操作失败"))}},N=async s=>{try{await A.confirm("确定拒绝此邀请吗？","确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=await q(s.message_id);e.code===200?(n.success("已拒绝邀请"),s.is_read=!0,await y()):n.error(e.message||"操作失败")}catch(e){e!=="cancel"&&(console.error("拒绝邀请失败:",e),n.error("操作失败"))}},C=async s=>{var e;try{r.value=r.value.filter(l=>l.message_id!==s),((e=a.value)==null?void 0:e.message_id)===s&&(a.value=null),n.success("删除成功")}catch{n.error("删除失败")}},b=async s=>{},z=()=>{i.value=f(r.value.filter(s=>s.selected))},S=async()=>{try{const s=i.value.map(e=>b(e.message_id));await Promise.all(s),i.value.forEach(e=>{const l=r.value.find(_=>_.message_id===e.message_id);l&&(l.is_read=!0)}),i.value=[],n.success("标记已读成功")}catch{n.error("标记已读失败")}},E=async()=>{try{const s=i.value.map(e=>C(e.message_id));await Promise.all(s),i.value=[],n.success("批量删除成功")}catch{n.error("批量删除失败")}},R=s=>s.title==="文件共享邀请提醒";return L(()=>{y()}),(s,e)=>{const l=h("el-button"),_=h("el-checkbox"),T=h("el-empty");return u(),m("div",K,[t("div",Q,[t("div",W,[e[6]||(e[6]=t("h2",null,"消息中心",-1)),t("div",X,[d(l,{type:"primary",size:"small",disabled:!i.value.length,onClick:S},{default:v(()=>e[4]||(e[4]=[g(" 标记已读 ")])),_:1,__:[4]},8,["disabled"]),d(l,{type:"danger",size:"small",disabled:!i.value.length,onClick:E},{default:v(()=>e[5]||(e[5]=[g(" 删除选中 ")])),_:1,__:[5]},8,["disabled"])])]),t("div",Y,[(u(!0),m(I,null,$(r.value,o=>{var w;return u(),m("div",{key:o.message_id,class:B(["message-item",{"message-unread":!o.is_read,"message-selected":o===a.value}]),onClick:M=>P(o)},[t("div",ee,[t("div",se,[t("span",te,c(o.sender_id),1),t("span",ae,c(k(o.created_at)),1)]),t("div",oe,[d(_,{modelValue:o.selected,"onUpdate:modelValue":M=>o.selected=M,onClick:e[0]||(e[0]=G(()=>{},["stop"])),onChange:z},null,8,["modelValue","onUpdate:modelValue"])])]),t("h3",{class:B(["message-item-title",{"font-bold":!o.is_read}])},c(o.title),3),t("p",ne,c((w=o.content)==null?void 0:w.substring(0,100))+"...",1)],10,Z)}),128))])]),a.value?(u(),m("div",le,[t("div",ie,[t("h2",null,c(a.value.title),1),t("div",ce,[R(a.value)?(u(),m(I,{key:0},[d(l,{type:"success",size:"small",icon:x(U),onClick:e[1]||(e[1]=o=>V(a.value)),class:"action-button"},{default:v(()=>e[7]||(e[7]=[g(" 接受 ")])),_:1,__:[7]},8,["icon"]),d(l,{type:"danger",size:"small",icon:x(j),onClick:e[2]||(e[2]=o=>N(a.value)),class:"action-button"},{default:v(()=>e[8]||(e[8]=[g(" 拒绝 ")])),_:1,__:[8]},8,["icon"])],64)):F("",!0),d(l,{type:"text",icon:x(J),onClick:e[3]||(e[3]=o=>C(a.value.message_id))},{default:v(()=>e[9]||(e[9]=[g(" 删除 ")])),_:1,__:[9]},8,["icon"])])]),t("div",re,[t("span",de,"从："+c(a.value.sender_id),1),t("span",_e,c(k(a.value.created_at)),1)]),t("div",ue,c(a.value.content),1)])):(u(),m("div",me,[d(T,{description:"选择一条消息查看详情"})]))])}}},he=D(ve,[["__scopeId","data-v-64435c7a"]]);export{he as default};
