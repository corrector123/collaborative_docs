import{_ as M,l as m,r as x,o as d,c as p,b as y,F as T,j as k,n as b,C as g,t as z,u as I,q as S,y as c,E as v}from"./index-c880b6c1.js";import{c as E}from"./share-e075428a.js";import{e as O}from"./execcontent-0635da60.js";import{p as D}from"./index-5d2175ad.js";const L=["onClick"],N={__name:"filecontentmenu",emits:["putFileToRecycle","rename"],setup(R,{expose:C,emit:h}){let a=m([{name:"分享",icon:"icon-shujugongxiang",command:"shear"},{name:"删除",icon:"icon-huishouzhan",command:"delete"},{name:"重命名",icon:"icon-zhongmingming",command:"rename"},{name:"移动至",icon:"icon-yidong"},{name:"360压缩",icon:"icon-yasuobao",color:"#51BDF4"}]),_=x(!0),e=m({});const s=m({x:0,y:0,display:"none"});let u=x(0);const F=async(t,i)=>{let{username:n,userid:o}=JSON.parse(sessionStorage.getItem("user"));switch(i){case"shear":let l=E(n,e.fileid,e.filename+"."+e.filesuffix);return O(l),c.success("分享链接已复制到粘贴板");case"delete":if(!e.fileid)return;try{await v.confirm(`确认删除 ${e.filename+"."+e.filesuffix} 吗？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});let{code:r,msg:f}=await D({fileid:e.fileid,userid:o});if(r!==200)return c.error(f);c.success(f),h("putFileToRecycle",e.fileid)}catch{c.info("已取消")}return;case"rename":return h("rename",u.value);case"delete_recycle":try{await v.confirm(`确认彻底删除 ${e.filename+"."+e.filesuffix} 吗？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"})}catch{c.info("已取消")}return;case"restore":c.warning("暂未实现");return}},w=t=>{_.value=!t.className.includes("icon-24gf-folderOpen");let{fileid:i,filename:n,filesuffix:o,folderid:l}=t.dataset;e.fileid=i,e.folderid=l,e.filename=n,e.filesuffix=o;let r={name:"打开",icon:"icon-24gf-folderOpen",color:"#FFD153"},f=a.find(B=>B.icon==="icon-24gf-folderOpen");_.value?f&&a.shift():f||a.unshift(r)};return C({showContentMenu:(t,i,n="")=>{n==="recycle"&&(a.length=0,a.push({name:"还原",icon:"icon-chexiao",command:"restore"},{name:"彻底删除",icon:"icon-huishouzhan",command:"delete_recycle"})),u.value=i;let{target:o}=t;w(o),s.x=o.offsetLeft+t.offsetX,s.y=o.offsetTop+t.offsetY,s.display="block"},hiddenContentMenu:()=>(s.display="none",u.value=0)}),(t,i)=>(d(),p("div",null,[y("div",{onContextmenu:i[0]||(i[0]=S(()=>{},["stop"])),class:"contentmenu",style:g({left:s.x+"px",top:s.y+"px",display:s.display})},[(d(!0),p(T,null,k(I(a),(n,o)=>(d(),p("div",{key:o,onClick:l=>F(l,n.command)},[y("i",{class:b(["iconfont",n.icon]),style:g({color:n.color})},null,6),y("span",null,z(n.name),1)],8,L))),128))],36)]))}},U=M(N,[["__scopeId","data-v-5b13627c"]]);export{U as f};
