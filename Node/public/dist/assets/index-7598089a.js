import{_ as ae,r as x,a as S,o as h,i as U,e as b,d as y,z as V,t as C,l as J,B as re,w as ee,f as v,m as de,c as M,u as p,v as ne,b as z,F as te,j as le,q as K,x as se,C as ce,n as ue,D as fe,G as pe,H as me,p as he,h as _e,y as oe}from"./index-afebe14d.js";import{C as ye}from"./index-86a65cfe.js";import{f as ge}from"./filecontentmenu-76777731.js";import{g as xe,u as ve,a as be}from"./index-279b5002.js";import{f as we}from"./shareDialog-b52cfb13.js";import"./index-8095d1b4.js";import"./index-04d20503.js";import"./index-d0fb5e77.js";import"./share-e40dc102.js";const ke={__name:"FilePropertiesDialog",setup(o,{expose:w}){const k=x(!1),_=x({});return w({show:async r=>{try{const g=await xe({fileid:r});_.value=g.data,k.value=!0}finally{}}}),(r,g)=>{const u=S("el-descriptions-item"),m=S("el-descriptions"),l=S("el-dialog");return h(),U(l,{modelValue:k.value,"onUpdate:modelValue":g[0]||(g[0]=s=>k.value=s),title:"文件属性",width:"500px"},{default:b(()=>[y(m,{column:1,border:""},{default:b(()=>[y(u,{label:"文件名"},{default:b(()=>[V(C(_.value.filename),1)]),_:1}),y(u,{label:"类型"},{default:b(()=>[V(C(_.value.filetype)+"文件（."+C(_.value.filesuffix)+"） ",1)]),_:1}),y(u,{label:"所有者"},{default:b(()=>[V(C(_.value.owner),1)]),_:1}),y(u,{label:"创建时间"},{default:b(()=>[V(C(_.value.createtime),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Me=ae(ke,[["__scopeId","data-v-34b90c74"]]),Ce=()=>{let o=J({isDragging:!1,dom:null,startX:0,startY:0,endX:0,endY:0,mode:"inside"}),w=J([]);function k(l){if(l.button===2)return;o.isDragging=!0,o.dom=document.querySelector(".mask"),o.dom.style.display="block",o.dom.style.width=0,o.dom.style.height=0;let{x:s,y:a}=r(l);o.startX=s,o.startY=a,o.dom.style.left=`${s}px`,o.dom.style.top=`${a}px`}function _(l){if(!o.isDragging)return;let{x:s,y:a}=r(l);s-o.startX<0&&(o.dom.style.left=`${s}px`),a-o.startY<0&&(o.dom.style.top=`${a}px`),o.dom.style.height=`${Math.abs(a-o.startY)}px`,o.dom.style.width=`${Math.abs(s-o.startX)}px`}async function R(l){if(l.button===2)return;let{x:s,y:a}=r(l);o.endX=s,o.endY=a;let i=await g();w.length=0,i.forEach(f=>{w.push(f),document.querySelector(`#${f}`).classList.add("ischoosed")}),o.isDragging=!1,o.dom.style.display="none",o.dom=null,o.startX=0,o.startY=0,o.endX=0,o.endY=0}function r(l){let{offsetLeft:s,offsetTop:a}=document.querySelector(".pages"),{clientX:i,clientY:f}=l;return{x:i-s,y:f-a}}function g(){return new Promise((l,s)=>{let{startX:a,startY:i,endX:f,endY:F}=o,A=Math.abs(a),B=Math.abs(i),N=Math.abs(f),T=Math.abs(F),H=[Math.min(A,N),Math.max(A,N)],$=[Math.min(B,T),Math.max(B,T)],D=[];document.querySelectorAll(".pages-list-files-item").forEach(P=>{P.classList.remove("ischoosed");let[j,X,G,Q]=u(P),L=m(j,H,$),W=m(X,H,$),Y=m(G,H,$),O=m(Q,H,$);function Z(){(L||W||Y||O)&&D.push(P.id)}function t(){L&&W&&Y&&O&&D.push(P.id)}o.mode==="inside"?Z():t()}),l(D)})}function u(l){let s=[],{offsetLeft:a,offsetTop:i,offsetWidth:f,offsetHeight:F}=l;return s.push({x:a,y:i}),s.push({x:a+f,y:i}),s.push({x:a+f,y:i+F}),s.push({x:a,y:i+F}),s}function m(l,s,a){let i=l.x>=s[0]&&l.x<=s[1],f=l.y>=a[0]&&l.y<=a[1];return i&&f}return{mouseDownHandle:k,mouseUpHandle:R,mouseMoveHandle:_,choosedDomID:w}};const De=o=>(he("data-v-142b4c20"),o=o(),_e(),o),Ie=["onContextmenu"],Se=De(()=>z("div",{class:"mask"},null,-1)),Re={class:"pages-list"},Fe={key:0,class:"pages-list-filesbread"},He={class:"pages-list-files"},$e=["onDblclick","onContextmenu","id"],Pe=["data-fileid","data-filename","data-filesuffix"],Ee=["onDblclick"],Xe=["onDblclick"],Ye={__name:"index",setup(o){const{mouseDownHandle:w,mouseUpHandle:k,mouseMoveHandle:_}=Ce(),R=re();var r=J([]);const g=x(null);let u=x(""),m=x(null),l=x(null),s=x(null);const a=x(null);let i=J([]),f=x("");ee(()=>R.state.searchKeyWord,t=>f.value=t,{immediate:!1,deep:!0}),ee(()=>R.state.topCreateData,t=>Y(t),{immediate:!1,deep:!0});const F=(t,e)=>{if(e==="folder")return"#ffd153";let d={docx:"#0f90e3",xlsx:"#01a408",pdf:"#ea5454",txt:"rgba(0, 0, 0, 0.6)",md:"#5A96DB"};return d[t]?d[t]:""},A=t=>{D(r[t])},B=t=>{a.value.show(t.fileid)},N=(t,e,d)=>{s.value.openDialog(t,e,d)},T=(t,e)=>{const{type:d}=e,c={folder:()=>{H(e),v.replace({query:{folderid:e.folderid,fromPath:v.currentRoute.value.query.folderid}})},word:()=>{R.dispatch("setEditorMode",{fileId:e.fileid,isReadOnly:!1}),v.push(`/word/${e.fileid}`)},excel:()=>v.push(`/excel/${e.fileid}`),markdown:()=>v.push(`/edit/${e.fileid}`),txt:()=>v.push(`/edit/${e.fileid}`)};c[d]&&c[d]()},H=t=>{i.push({name:t.foldername}),sessionStorage.setItem("pagelistbread",JSON.stringify(i))},$=()=>{i.pop(),v.replace({query:{folderid:v.currentRoute.value.query.fromPath}})},D=async t=>{r.forEach(e=>e.changeflag=!1),t.changeflag=!0,await se(),g.value[0].focus()},P=async()=>{let t="";if(r.forEach(e=>{e.changeflag&&(t=e.fileid,e.folderid,e.filename=u.value||e.filename,e.changeflag=!1)}),u.value){let e=t?await ve({fileid:t,newfilename:u.value}):{code:0,msg:"暂未实现文件夹更新"};e.code===200?oe.success(e.msg):oe.error(e.msg)}u.value=""},j=()=>g.value[0].blur();let X=x(!1);const G=async t=>{X.value=!0,await se(),m.value.showContentMenu(t),l.value.hiddenContentMenu()},Q=()=>{X.value=!1},L=()=>{m.value&&m.value.hiddenContentMenu(),l.value.hiddenContentMenu()},W=(t,e)=>(l.value.showContentMenu(t,e),m.value&&m.value.hiddenContentMenu()),Y=({name:t,id:e,type:d,suffix:c})=>{if(d==="folder")return r.push({type:"folder",foldername:t,folderid:e,icon:"icon-24gf-folderOpen"});let E={md:"icon-file-markdown1",txt:"icon-wenben1",xlsx:"icon-excel",docx:"icon-Word"};r.push({type:d,fileid:e,filename:t,filesuffix:c,suffix:c,icon:E[c]})},O=t=>{r.splice(r.findIndex(e=>e.fileid===t),1)},Z=t=>{const e={md:{type:"markdown",icon:"icon-file-markdown1"},txt:{type:"txt",icon:"icon-wenben1"},xlsx:{type:"excel",icon:"icon-excel"},docx:{type:"word",icon:"icon-Word"},folder:{type:"folder",icon:"icon-24gf-folderOpen"}};function d(c){c&&(t.type=e[c].type,t.icon=e[c].icon)}t.folderid?d("folder"):d(t.filesuffix),t.suffix=t.filesuffix};return ee(v.currentRoute,async t=>{if(t.path!="/home/pages")return;r.length=0;let{userid:e}=JSON.parse(sessionStorage.getItem("user")),{folderid:d}=t.query;d||(i.length=0,sessionStorage.setItem("pagelistbread",[]));let c=await be({userid:e,folderid:d});if(c.code!==200)return oe.error(c.msg);c.data.length&&c.data.forEach(E=>{Z(E),r.push(E)})},{immediate:!0,deep:!0}),de(()=>{let t=sessionStorage.getItem("pagelistbread");t&&JSON.parse(t).forEach(e=>i.push(e))}),(t,e)=>{const d=S("el-icon"),c=S("el-breadcrumb-item"),E=S("el-breadcrumb"),ie=S("el-input");return h(),M("div",{id:"pages",class:"pages",onClick:L,onContextmenu:K(G,["prevent","stop"]),onMousedown:e[1]||(e[1]=(...n)=>p(w)&&p(w)(...n)),onMouseup:e[2]||(e[2]=(...n)=>p(k)&&p(k)(...n)),onMousemove:e[3]||(e[3]=(...n)=>p(_)&&p(_)(...n))},[Se,p(X)?(h(),U(ye,{key:0,ref_key:"contentmenuRef",ref:m,onCreate:Y,onClose:Q},null,512)):ne("",!0),y(ge,{ref_key:"filecontentmenuRef",ref:l,onPutFileToRecycle:O,onRename:A,onShowProperties:B,onShowShareWindow:N,fileList:p(r)},null,8,["fileList"]),y(Me,{ref_key:"propertiesDialog",ref:a},null,512),y(we,{ref_key:"shareDialog",ref:s},null,512),z("div",Re,[p(i).length?(h(),M("div",Fe,[y(d,{onClick:$},{default:b(()=>[y(p(ce))]),_:1}),y(E,{separator:"/"},{default:b(()=>[(h(!0),M(te,null,le(p(i),(n,q)=>(h(),U(c,{key:q},{default:b(()=>[V(C(n.name),1)]),_:2},1024))),128))]),_:1})])):ne("",!0),z("div",He,[(h(!0),M(te,null,le(p(r).filter(n=>!p(f)||(n.filename||n.foldername).includes(p(f))),(n,q)=>(h(),M("div",{onDblclick:I=>T(q,n),onContextmenu:K(I=>W(I,q),["prevent","stop"]),class:"pages-list-files-item",key:q,id:n.fileid||n.folderid},[z("i",{"data-fileid":n.fileid,"data-filename":n.filename,"data-filesuffix":n.suffix||n.filesuffix,class:ue(["iconfont",n.icon]),style:fe({color:F(n.suffix,n.type)})},null,14,Pe),n.changeflag?(h(),U(ie,{key:1,ref_for:!0,ref_key:"inputRef",ref:g,onBlur:P,onKeydown:pe(j,["enter"]),modelValue:p(u),"onUpdate:modelValue":e[0]||(e[0]=I=>me(u)?u.value=I:u=I)},null,8,["onKeydown","modelValue"])):(h(),M(te,{key:0},[n.type==="folder"?(h(),M("span",{key:0,onDblclick:K(I=>D(n),["stop"])},C(n.foldername),41,Ee)):(h(),M("span",{key:1,onDblclick:K(I=>D(n),["stop"])},C(n.filename+"."+n.suffix),41,Xe))],64))],40,$e))),128))])])],40,Ie)}}},Ke=ae(Ye,[["__scopeId","data-v-142b4c20"]]);export{Ke as default};
