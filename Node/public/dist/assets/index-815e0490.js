import{_ as ne,r as _,a as D,o as w,i as q,e as m,d as g,z as R,t as T,b as P,c as $,v as le,F as j,j as se,u as x,y as E,p as de,h as ue,l as G,w as oe,f as H,m as pe,q as J,x as ie,B as me,n as _e,C as ge,D as ve,G as he,g as re}from"./index-64535f4c.js";import{C as ye}from"./index-1622d668.js";import{f as be}from"./filecontentmenu-966fa7dc.js";import{g as ce,u as xe,a as we}from"./index-f081d166.js";import{f as Ie}from"./index-66066997.js";import{C as ke}from"./index-92c6daa4.js";import{s as Ce}from"./index-d17dce4a.js";import{c as De}from"./share-74c672df.js";import{e as Me}from"./execcontent-0635da60.js";import"./index-ab6c0fa4.js";const Ve={__name:"FilePropertiesDialog",setup(o,{expose:V}){const I=_(!1),b=_({});return V({show:async v=>{try{const h=await ce({fileid:v});b.value=h.data,I.value=!0}finally{}}}),(v,h)=>{const u=D("el-descriptions-item"),C=D("el-descriptions"),i=D("el-dialog");return w(),q(i,{modelValue:I.value,"onUpdate:modelValue":h[0]||(h[0]=s=>I.value=s),title:"文件属性",width:"500px"},{default:m(()=>[g(C,{column:1,border:""},{default:m(()=>[g(u,{label:"文件名"},{default:m(()=>[R(T(b.value.filename),1)]),_:1}),g(u,{label:"类型"},{default:m(()=>[R(T(b.value.filetype)+"文件（."+T(b.value.filesuffix)+"） ",1)]),_:1}),g(u,{label:"所有者"},{default:m(()=>[R(T(b.value.owner),1)]),_:1}),g(u,{label:"创建时间"},{default:m(()=>[R(T(b.value.createtime),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},Se=ne(Ve,[["__scopeId","data-v-34b90c74"]]),Q={EDITOR:{value:"edit",label:"编辑者",description:"可以查看和编辑文件"},VIEWER:{value:"read",label:"只读观众",description:"仅可查看文件"}},$e=()=>[Q.EDITOR,Q.VIEWER];const ae=o=>(de("data-v-3e08b2bb"),o=o(),ue(),o),Ee={class:"dialog-item"},Re=ae(()=>P("span",{class:"label"},"分享方式：",-1)),Pe={key:0,class:"dialog-item"},Fe=ae(()=>P("span",{class:"label"},"分享给用户ID：",-1)),He={class:"dialog-item"},Te=ae(()=>P("span",{class:"label"},"设置权限：",-1)),Ae={class:"dialog-footer"},Ue={__name:"shareDialog",setup(o,{expose:V}){const I=_(!1),b=_("user"),r=_(""),v=_(Q.VIEWER.value),h=$e(),u=_(""),C=_(""),i=_(""),s=_({}),n=async(f,l,S)=>{try{const F=await ce({fileid:f});s.value=F.data,I.value=!0,r.value="",u.value=s.value.fileid,i.value=S,C.value=l,v.value=Q.VIEWER.value}finally{}},c=f=>{f()},k=async()=>{if(b.value==="user"){if(!r.value)return E.warning("请输入用户ID");try{const f=await Ie({targetUserId:r.value});if(f.code===2002)return E.error(f.msg||"用户不存在！");const l=await Ce({userId:r.value,fileId:u.value,permissionType:v.value});if(l.code!==200)return l.code===400?E.error(l.msg||"用户不存在！"):E.error("设置权限失败");await A(r.value),E.success("分享消息已发送！"),I.value=!1}catch(f){console.error("查询用户出错：",f),E.error("查询用户失败，请稍后重试")}}else{const f=s.value.filename+"."+s.value.filesuffix;let l=De(C.value,i.value,u.value,f,v.value);return Me(l),E.success("分享链接已复制到粘贴板")}I.value=!1},A=async f=>{try{const l=await ke({userid:0,targetId:f,fileId:u.value,permissionType:v.value});if(l.code===200)return console.log("邀请创建成功"),l.data;throw console.error("创建邀请失败:",l.message),new Error(l.message)}catch(l){throw console.error("API调用出错:",l),l}};return V({openDialog:n}),(f,l)=>{const S=D("el-radio"),F=D("el-radio-group"),U=D("el-input"),M=D("el-button"),W=D("el-dialog");return w(),q(W,{modelValue:I.value,"onUpdate:modelValue":l[4]||(l[4]=d=>I.value=d),title:"分享设置",width:"500px","before-close":c},{footer:m(()=>[P("span",Ae,[g(M,{onClick:l[3]||(l[3]=d=>I.value=!1)},{default:m(()=>[R("取消")]),_:1}),g(M,{type:"primary",onClick:k},{default:m(()=>[R("确定")]),_:1})])]),default:m(()=>[P("div",Ee,[Re,g(F,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=d=>b.value=d)},{default:m(()=>[g(S,{label:"user"},{default:m(()=>[R("分享给指定用户")]),_:1}),g(S,{label:"link"},{default:m(()=>[R("生成分享链接")]),_:1})]),_:1},8,["modelValue"])]),b.value==="user"?(w(),$("div",Pe,[Fe,g(U,{modelValue:r.value,"onUpdate:modelValue":l[1]||(l[1]=d=>r.value=d),placeholder:"请输入用户ID",clearable:""},null,8,["modelValue"])])):le("",!0),P("div",He,[Te,g(F,{modelValue:v.value,"onUpdate:modelValue":l[2]||(l[2]=d=>v.value=d)},{default:m(()=>[(w(!0),$(j,null,se(x(h),d=>(w(),q(S,{key:d.value,label:d.value},{default:m(()=>[R(T(d.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}},We=ne(Ue,[["__scopeId","data-v-3e08b2bb"]]),Xe=()=>{let o=G({isDragging:!1,dom:null,startX:0,startY:0,endX:0,endY:0,mode:"inside"}),V=G([]);function I(i){if(i.button===2)return;o.isDragging=!0,o.dom=document.querySelector(".mask"),o.dom.style.display="block",o.dom.style.width=0,o.dom.style.height=0;let{x:s,y:n}=v(i);o.startX=s,o.startY=n,o.dom.style.left=`${s}px`,o.dom.style.top=`${n}px`}function b(i){if(!o.isDragging)return;let{x:s,y:n}=v(i);s-o.startX<0&&(o.dom.style.left=`${s}px`),n-o.startY<0&&(o.dom.style.top=`${n}px`),o.dom.style.height=`${Math.abs(n-o.startY)}px`,o.dom.style.width=`${Math.abs(s-o.startX)}px`}async function r(i){if(i.button===2)return;let{x:s,y:n}=v(i);o.endX=s,o.endY=n;let c=await h();V.length=0,c.forEach(k=>{V.push(k),document.querySelector(`#${k}`).classList.add("ischoosed")}),o.isDragging=!1,o.dom.style.display="none",o.dom=null,o.startX=0,o.startY=0,o.endX=0,o.endY=0}function v(i){let{offsetLeft:s,offsetTop:n}=document.querySelector(".pages"),{clientX:c,clientY:k}=i;return{x:c-s,y:k-n}}function h(){return new Promise((i,s)=>{let{startX:n,startY:c,endX:k,endY:A}=o,f=Math.abs(n),l=Math.abs(c),S=Math.abs(k),F=Math.abs(A),U=[Math.min(f,S),Math.max(f,S)],M=[Math.min(l,F),Math.max(l,F)],W=[];document.querySelectorAll(".pages-list-files-item").forEach(d=>{d.classList.remove("ischoosed");let[N,Z,ee,te]=u(d),L=C(N,U,M),O=C(Z,U,M),K=C(ee,U,M),z=C(te,U,M);function t(){(L||O||K||z)&&W.push(d.id)}function e(){L&&O&&K&&z&&W.push(d.id)}o.mode==="inside"?t():e()}),i(W)})}function u(i){let s=[],{offsetLeft:n,offsetTop:c,offsetWidth:k,offsetHeight:A}=i;return s.push({x:n,y:c}),s.push({x:n+k,y:c}),s.push({x:n+k,y:c+A}),s.push({x:n,y:c+A}),s}function C(i,s,n){let c=i.x>=s[0]&&i.x<=s[1],k=i.y>=n[0]&&i.y<=n[1];return c&&k}return{mouseDownHandle:I,mouseUpHandle:r,mouseMoveHandle:b,choosedDomID:V}};const Ye=o=>(de("data-v-afbcc144"),o=o(),ue(),o),qe=["onContextmenu"],Ne=Ye(()=>P("div",{class:"mask"},null,-1)),Oe={class:"pages-list"},Be={key:0,class:"pages-list-filesbread"},Le={class:"pages-list-files"},Ke=["onDblclick","onContextmenu","id"],ze=["data-fileid","data-filename","data-filesuffix"],Je=["onDblclick"],je=["onDblclick"],Ge={__name:"index",setup(o){const{mouseDownHandle:V,mouseUpHandle:I,mouseMoveHandle:b}=Xe();var r=G([]);const v=_(null);let h=_(""),u=_(null),C=_(null),i=_(null);const s=_(null);let n=G([]),c=_("");oe(()=>re.state.searchKeyWord,t=>c.value=t,{immediate:!1,deep:!0}),oe(()=>re.state.topCreateData,t=>O(t),{immediate:!1,deep:!0});const k=(t,e)=>{if(e==="folder")return"#ffd153";let p={docx:"#0f90e3",xlsx:"#01a408",pdf:"#ea5454",txt:"rgba(0, 0, 0, 0.6)",md:"#5A96DB"};return p[t]?p[t]:""},A=t=>{M(r[t])},f=t=>{s.value.show(t.fileid)},l=(t,e,p)=>{i.value.openDialog(t,e,p)},S=(t,e)=>{const{type:p}=e,y={folder:()=>{F(e),H.replace({query:{folderid:e.folderid,fromPath:H.currentRoute.value.query.folderid}})},word:()=>H.push(`/word/${e.fileid}`),excel:()=>H.push(`/excel/${e.fileid}`),markdown:()=>H.push(`/edit/${e.fileid}`),txt:()=>H.push(`/edit/${e.fileid}`)};y[p]&&y[p]()},F=t=>{n.push({name:t.foldername}),sessionStorage.setItem("pagelistbread",JSON.stringify(n))},U=()=>{n.pop(),H.replace({query:{folderid:H.currentRoute.value.query.fromPath}})},M=async t=>{r.forEach(e=>e.changeflag=!1),t.changeflag=!0,await ie(),v.value[0].focus()},W=async()=>{let t="";if(r.forEach(e=>{e.changeflag&&(t=e.fileid,e.folderid,e.filename=h.value||e.filename,e.changeflag=!1)}),h.value){let e=t?await xe({fileid:t,newfilename:h.value}):{code:0,msg:"暂未实现文件夹更新"};e.code===200?E.success(e.msg):E.error(e.msg)}h.value=""},d=()=>v.value[0].blur();let N=_(!1);const Z=async t=>{N.value=!0,await ie(),u.value.showContentMenu(t),C.value.hiddenContentMenu()},ee=()=>{N.value=!1},te=()=>{u.value&&u.value.hiddenContentMenu(),C.value.hiddenContentMenu()},L=(t,e)=>(C.value.showContentMenu(t,e),u.value&&u.value.hiddenContentMenu()),O=({name:t,id:e,type:p,suffix:y})=>{if(p==="folder")return r.push({type:"folder",foldername:t,folderid:e,icon:"icon-24gf-folderOpen"});let Y={md:"icon-file-markdown1",txt:"icon-wenben1",xlsx:"icon-excel",docx:"icon-Word"};r.push({type:p,fileid:e,filename:t,filesuffix:y,suffix:y,icon:Y[y]})},K=t=>{r.splice(r.findIndex(e=>e.fileid===t),1)},z=t=>{const e={md:{type:"markdown",icon:"icon-file-markdown1"},txt:{type:"txt",icon:"icon-wenben1"},xlsx:{type:"excel",icon:"icon-excel"},docx:{type:"word",icon:"icon-Word"},folder:{type:"folder",icon:"icon-24gf-folderOpen"}};function p(y){y&&(t.type=e[y].type,t.icon=e[y].icon)}t.folderid?p("folder"):p(t.filesuffix),t.suffix=t.filesuffix};return oe(H.currentRoute,async t=>{if(t.path!="/home/pages")return;r.length=0;let{userid:e}=JSON.parse(sessionStorage.getItem("user")),{folderid:p}=t.query;p||(n.length=0,sessionStorage.setItem("pagelistbread",[]));let y=await we({userid:e,folderid:p});if(y.code!==200)return E.error(y.msg);y.data.length&&y.data.forEach(Y=>{z(Y),r.push(Y)})},{immediate:!0,deep:!0}),pe(()=>{let t=sessionStorage.getItem("pagelistbread");t&&JSON.parse(t).forEach(e=>n.push(e))}),(t,e)=>{const p=D("el-icon"),y=D("el-breadcrumb-item"),Y=D("el-breadcrumb"),fe=D("el-input");return w(),$("div",{id:"pages",class:"pages",onClick:te,onContextmenu:J(Z,["prevent","stop"]),onMousedown:e[1]||(e[1]=(...a)=>x(V)&&x(V)(...a)),onMouseup:e[2]||(e[2]=(...a)=>x(I)&&x(I)(...a)),onMousemove:e[3]||(e[3]=(...a)=>x(b)&&x(b)(...a))},[Ne,x(N)?(w(),q(ye,{key:0,ref_key:"contentmenuRef",ref:u,onCreate:O,onClose:ee},null,512)):le("",!0),g(be,{ref_key:"filecontentmenuRef",ref:C,onPutFileToRecycle:K,onRename:A,onShowProperties:f,onShowShareWindow:l,fileList:x(r)},null,8,["fileList"]),g(Se,{ref_key:"propertiesDialog",ref:s},null,512),g(We,{ref_key:"shareDialog",ref:i},null,512),P("div",Oe,[x(n).length?(w(),$("div",Be,[g(p,{onClick:U},{default:m(()=>[g(x(me))]),_:1}),g(Y,{separator:"/"},{default:m(()=>[(w(!0),$(j,null,se(x(n),(a,B)=>(w(),q(y,{key:B},{default:m(()=>[R(T(a.name),1)]),_:2},1024))),128))]),_:1})])):le("",!0),P("div",Le,[(w(!0),$(j,null,se(x(r).filter(a=>!x(c)||(a.filename||a.foldername).includes(x(c))),(a,B)=>(w(),$("div",{onDblclick:X=>S(B,a),onContextmenu:J(X=>L(X,B),["prevent","stop"]),class:"pages-list-files-item",key:B,id:a.fileid||a.folderid},[P("i",{"data-fileid":a.fileid,"data-filename":a.filename,"data-filesuffix":a.suffix||a.filesuffix,class:_e(["iconfont",a.icon]),style:ge({color:k(a.suffix,a.type)})},null,14,ze),a.changeflag?(w(),q(fe,{key:1,ref_for:!0,ref_key:"inputRef",ref:v,onBlur:W,onKeydown:ve(d,["enter"]),modelValue:x(h),"onUpdate:modelValue":e[0]||(e[0]=X=>he(h)?h.value=X:h=X)},null,8,["onKeydown","modelValue"])):(w(),$(j,{key:0},[a.type==="folder"?(w(),$("span",{key:0,onDblclick:J(X=>M(a),["stop"])},T(a.foldername),41,Je)):(w(),$("span",{key:1,onDblclick:J(X=>M(a),["stop"])},T(a.filename+"."+a.suffix),41,je))],64))],40,Ke))),128))])])],40,qe)}}},rt=ne(Ge,[["__scopeId","data-v-afbcc144"]]);export{rt as default};
