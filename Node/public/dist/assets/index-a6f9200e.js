import{l as P,_ as oe,r as S,w as W,f as y,m as ne,a as N,o as p,c as v,u as c,i as z,v as Q,d as T,b as B,e as J,F as U,j as Z,q as A,B as se,z as le,t as j,n as ae,C as ie,D as re,G as de,p as ce,h as ue,g as ee,x as te,y as G}from"./index-0730b0a8.js";import{C as fe}from"./index-2cfa7691.js";import{f as pe}from"./filecontentmenu-37fbdc2b.js";import{u as me,g as he}from"./index-e8b3879d.js";import"./index-fc85edcf.js";import"./share-ec9309b0.js";import"./execcontent-0635da60.js";const ye=()=>{let o=P({isDragging:!1,dom:null,startX:0,startY:0,endX:0,endY:0,mode:"inside"}),k=P([]);function $(s){if(s.button===2)return;o.isDragging=!0,o.dom=document.querySelector(".mask"),o.dom.style.display="block",o.dom.style.width=0,o.dom.style.height=0;let{x:l,y:a}=b(s);o.startX=l,o.startY=a,o.dom.style.left=`${l}px`,o.dom.style.top=`${a}px`}function X(s){if(!o.isDragging)return;let{x:l,y:a}=b(s);l-o.startX<0&&(o.dom.style.left=`${l}px`),a-o.startY<0&&(o.dom.style.top=`${a}px`),o.dom.style.height=`${Math.abs(a-o.startY)}px`,o.dom.style.width=`${Math.abs(l-o.startX)}px`}async function f(s){if(s.button===2)return;let{x:l,y:a}=b(s);o.endX=l,o.endY=a;let d=await m();k.length=0,d.forEach(u=>{k.push(u),document.querySelector(`#${u}`).classList.add("ischoosed")}),o.isDragging=!1,o.dom.style.display="none",o.dom=null,o.startX=0,o.startY=0,o.endX=0,o.endY=0}function b(s){let{offsetLeft:l,offsetTop:a}=document.querySelector(".pages"),{clientX:d,clientY:u}=s;return{x:d-l,y:u-a}}function m(){return new Promise((s,l)=>{let{startX:a,startY:d,endX:u,endY:C}=o,Y=Math.abs(a),M=Math.abs(d),q=Math.abs(u),E=Math.abs(C),x=[Math.min(Y,q),Math.max(Y,q)],D=[Math.min(M,E),Math.max(M,E)],R=[];document.querySelectorAll(".pages-list-files-item").forEach(I=>{I.classList.remove("ischoosed");let[V,F,K,L]=g(I),t=h(V,x,D),e=h(F,x,D),r=h(K,x,D),i=h(L,x,D);function _(){(t||e||r||i)&&R.push(I.id)}function O(){t&&e&&r&&i&&R.push(I.id)}o.mode==="inside"?_():O()}),s(R)})}function g(s){let l=[],{offsetLeft:a,offsetTop:d,offsetWidth:u,offsetHeight:C}=s;return l.push({x:a,y:d}),l.push({x:a+u,y:d}),l.push({x:a+u,y:d+C}),l.push({x:a,y:d+C}),l}function h(s,l,a){let d=s.x>=l[0]&&s.x<=l[1],u=s.y>=a[0]&&s.y<=a[1];return d&&u}return{mouseDownHandle:$,mouseUpHandle:f,mouseMoveHandle:X,choosedDomID:k}};const ge=o=>(ce("data-v-223aa71c"),o=o(),ue(),o),xe=["onContextmenu"],_e=ge(()=>B("div",{class:"mask"},null,-1)),ve={class:"pages-list"},be={key:0,class:"pages-list-filesbread"},we={class:"pages-list-files"},ke=["onDblclick","onContextmenu","id"],Ce=["data-fileid","data-filename","data-filesuffix"],Me=["onDblclick"],De=["onDblclick"],Ie={__name:"index",setup(o){const{mouseDownHandle:k,mouseUpHandle:$,mouseMoveHandle:X}=ye();var f=P([]);const b=S(null);let m=S(""),g=S(null),h=S(null),s=P([]),l=S("");W(()=>ee.state.searchKeyWord,t=>l.value=t,{immediate:!1,deep:!0}),W(()=>ee.state.topCreateData,t=>F(t),{immediate:!1,deep:!0});const a=(t,e)=>{if(e==="folder")return"#ffd153";let r={docx:"#0f90e3",xlsx:"#01a408",pdf:"#ea5454",txt:"rgba(0, 0, 0, 0.6)",md:"#5A96DB"};return r[t]?r[t]:""},d=t=>{M(f[t])},u=(t,e)=>{const{type:r}=e,i={folder:()=>{C(e),y.replace({query:{folderid:e.folderid,fromPath:y.currentRoute.value.query.folderid}})},word:()=>y.push(`/word/${e.fileid}`),excel:()=>y.push(`/excel/${e.fileid}`),markdown:()=>y.push(`/edit/${e.fileid}`),txt:()=>y.push(`/edit/${e.fileid}`)};i[r]&&i[r]()},C=t=>{s.push({name:t.foldername}),sessionStorage.setItem("pagelistbread",JSON.stringify(s))},Y=()=>{s.pop(),y.replace({query:{folderid:y.currentRoute.value.query.fromPath}})},M=async t=>{f.forEach(e=>e.changeflag=!1),t.changeflag=!0,await te(),b.value[0].focus()},q=async()=>{let t="";if(f.forEach(e=>{e.changeflag&&(t=e.fileid,e.folderid,e.filename=m.value||e.filename,e.changeflag=!1)}),m.value){let e=t?await me({fileid:t,newfilename:m.value}):{code:0,msg:"暂未实现文件夹更新"};e.code===200?G.success(e.msg):G.error(e.msg)}m.value=""},E=()=>b.value[0].blur();let x=S(!1);const D=async t=>{x.value=!0,await te(),g.value.showContentMenu(t),h.value.hiddenContentMenu()},R=()=>{x.value=!1},I=()=>{g.value&&g.value.hiddenContentMenu(),h.value.hiddenContentMenu()},V=(t,e)=>(h.value.showContentMenu(t,e),g.value&&g.value.hiddenContentMenu()),F=({name:t,id:e,type:r,suffix:i})=>{if(r==="folder")return f.push({type:"folder",foldername:t,folderid:e,icon:"icon-24gf-folderOpen"});let _={md:"icon-file-markdown1",txt:"icon-wenben1",xlsx:"icon-excel",docx:"icon-Word"};f.push({type:r,fileid:e,filename:t,filesuffix:i,suffix:i,icon:_[i]})},K=t=>{f.splice(f.findIndex(e=>e.fileid===t),1)},L=t=>{const e={md:{type:"markdown",icon:"icon-file-markdown1"},txt:{type:"txt",icon:"icon-wenben1"},xlsx:{type:"excel",icon:"icon-excel"},docx:{type:"word",icon:"icon-Word"},folder:{type:"folder",icon:"icon-24gf-folderOpen"}};function r(i){i&&(t.type=e[i].type,t.icon=e[i].icon)}t.folderid?r("folder"):r(t.filesuffix),t.suffix=t.filesuffix};return W(y.currentRoute,async t=>{if(t.path!="/home/pages")return;f.length=0;let{userid:e}=JSON.parse(sessionStorage.getItem("user")),{folderid:r}=t.query;r||(s.length=0,sessionStorage.setItem("pagelistbread",[]));let i=await he({userid:e,folderid:r});if(i.code!==200)return G.error(i.msg);i.data.length&&i.data.forEach(_=>{L(_),f.push(_)})},{immediate:!0,deep:!0}),ne(()=>{let t=sessionStorage.getItem("pagelistbread");t&&JSON.parse(t).forEach(e=>s.push(e))}),(t,e)=>{const r=N("el-icon"),i=N("el-breadcrumb-item"),_=N("el-breadcrumb"),O=N("el-input");return p(),v("div",{id:"pages",class:"pages",onClick:I,onContextmenu:A(D,["prevent","stop"]),onMousedown:e[1]||(e[1]=(...n)=>c(k)&&c(k)(...n)),onMouseup:e[2]||(e[2]=(...n)=>c($)&&c($)(...n)),onMousemove:e[3]||(e[3]=(...n)=>c(X)&&c(X)(...n))},[_e,c(x)?(p(),z(fe,{key:0,ref_key:"contentmenuRef",ref:g,onCreate:F,onClose:R},null,512)):Q("",!0),T(pe,{ref_key:"filecontentmenuRef",ref:h,onPutFileToRecycle:K,onRename:d},null,512),B("div",ve,[c(s).length?(p(),v("div",be,[T(r,{onClick:Y},{default:J(()=>[T(c(se))]),_:1}),T(_,{separator:"/"},{default:J(()=>[(p(!0),v(U,null,Z(c(s),(n,H)=>(p(),z(i,{key:H},{default:J(()=>[le(j(n.name),1)]),_:2},1024))),128))]),_:1})])):Q("",!0),B("div",we,[(p(!0),v(U,null,Z(c(f).filter(n=>!c(l)||(n.filename||n.foldername).includes(c(l))),(n,H)=>(p(),v("div",{onDblclick:w=>u(H,n),onContextmenu:A(w=>V(w,H),["prevent","stop"]),class:"pages-list-files-item",key:H,id:n.fileid||n.folderid},[B("i",{"data-fileid":n.fileid,"data-filename":n.filename,"data-filesuffix":n.suffix||n.filesuffix,class:ae(["iconfont",n.icon]),style:ie({color:a(n.suffix,n.type)})},null,14,Ce),n.changeflag?(p(),z(O,{key:1,ref_for:!0,ref_key:"inputRef",ref:b,onBlur:q,onKeydown:re(E,["enter"]),modelValue:c(m),"onUpdate:modelValue":e[0]||(e[0]=w=>de(m)?m.value=w:m=w)},null,8,["onKeydown","modelValue"])):(p(),v(U,{key:0},[n.type==="folder"?(p(),v("span",{key:0,onDblclick:A(w=>M(n),["stop"])},j(n.foldername),41,Me)):(p(),v("span",{key:1,onDblclick:A(w=>M(n),["stop"])},j(n.filename+"."+n.suffix),41,De))],64))],40,ke))),128))])])],40,xe)}}},Ee=oe(Ie,[["__scopeId","data-v-223aa71c"]]);export{Ee as default};
