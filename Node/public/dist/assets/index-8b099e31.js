import{_ as O,r as C,w as P,a as g,o as f,c as S,b as e,d as r,e as d,u as y,s as te,n as T,f as $,g as z,E as k,p as j,h as K,i as R,F as U,j as W,t as H,k as ne,l as A,m as se,q as V,v as J,x as oe,y as D,z as ae,A as ie}from"./index-dd22766f.js";import{g as le,s as ce,c as re}from"./index-1fef8f8c.js";import{C as de}from"./index-5eeefd77.js";const p=n=>(j("data-v-43590732"),n=n(),K(),n),ue={class:"aside"},_e=p(()=>e("div",{class:"aside-logo"},[e("i",{class:"iconfont icon-circulation"}),e("span",{title:"多人协作编辑器"}," 多人协作编辑器 ")],-1)),pe={class:"aside-search"},me=p(()=>e("i",{class:"iconfont icon-shouye-zhihui"},null,-1)),he=p(()=>e("span",null," 首页 ",-1)),fe=[me,he],ge=p(()=>e("i",{class:"iconfont icon-zuijinchangyong"},null,-1)),ve=p(()=>e("span",null," 最近文档 ",-1)),ye=[ge,ve],xe=p(()=>e("i",{class:"iconfont icon-shujugongxiang"},null,-1)),we=p(()=>e("span",null," 与我共享 ",-1)),Ce=[xe,we],$e=p(()=>e("i",{class:"iconfont icon-shoucang2"},null,-1)),be=p(()=>e("span",null," 我的收藏 ",-1)),ke=[$e,be],Se=p(()=>e("i",{class:"iconfont icon-xiaoxizhongxin"},null,-1)),Me=p(()=>e("span",null," 消息中心 ",-1)),Ie=[Se,Me],Te=p(()=>e("i",{class:"iconfont icon-huishouzhan"},null,-1)),Fe=p(()=>e("span",null," 回收站 ",-1)),Re=[Te,Fe],ze={__name:"aside",props:{activeMenu:{type:String,default:"pages"}},setup(n){const a=C("");P(a,s=>z.commit("setSearchKeyWord",s));const u=async()=>{try{const s=JSON.parse(sessionStorage.getItem("user")),t=await le(s.userid);if(t.code!==200)return k.error(t.msg);z.commit("setFavorFiles",t.data)}catch(s){console.error("获取收藏文件失败:",s)}},o=s=>$.push(`/home/${s}`);return(s,t)=>{const l=g("el-icon"),m=g("el-input");return f(),S("div",ue,[_e,e("div",pe,[r(m,{placeholder:"搜索",modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=c=>a.value=c),clearable:""},{prefix:d(()=>[r(l,null,{default:d(()=>[r(y(te))]),_:1})]),_:1},8,["modelValue"])]),e("div",{class:T(["aside-icon",{active:n.activeMenu==="pages"}]),onClick:t[1]||(t[1]=c=>o("pages"))},fe,2),e("div",{class:T(["aside-icon",{active:n.activeMenu==="news"}]),onClick:t[2]||(t[2]=c=>o("news"))},ye,2),e("div",{class:T(["aside-icon",{active:n.activeMenu==="share"}]),onClick:t[3]||(t[3]=c=>o("share"))},Ce,2),e("div",{class:T(["aside-icon",{active:n.activeMenu==="favor"}]),onClick:u},ke,2),e("div",{class:T(["aside-icon",{active:n.activeMenu==="messageCentre"}]),onClick:t[4]||(t[4]=c=>o("messageCentre"))},Ie,2),e("div",{class:"aside-bottom",onClick:t[5]||(t[5]=c=>y($).push("/recycle"))},Re)])}}},Oe=O(ze,[["__scopeId","data-v-43590732"]]);const Be={style:{width:"100%",height:"100%"}},Ne={class:"dropdownItem"},Ve=["title"],Ae={__name:"index",props:{trigger:{type:String,default:"click"},list:{type:Array,default:()=>[]}},emits:["handleCommand","handleOpen","handleClose"],setup(n,{emit:a}){const u=t=>a("handleCommand",t),o=()=>a("handleOpen"),s=()=>a("handleClose");return(t,l)=>{const m=g("el-dropdown-item"),c=g("el-dropdown-menu"),v=g("el-dropdown");return f(),R(v,{trigger:n.trigger,onHandleOpen:o,onHandleClose:s,onCommand:u},{dropdown:d(()=>[r(c,null,{default:d(()=>[(f(!0),S(U,null,W(n.list,_=>(f(),R(m,{key:_.command,command:_.command},{default:d(()=>[e("div",Ne,[e("i",{class:T(["iconfont",_.icon])},null,2),e("span",{title:_.name},H(_.name),9,Ve)])]),_:2},1032,["command"]))),128))]),_:1})]),default:d(()=>[e("div",Be,[ne(t.$slots,"content",{},void 0,!0)])]),_:3},8,["trigger"])}}},He=O(Ae,[["__scopeId","data-v-d3abf79c"]]),Ee=(n,a,u="Typora")=>new Promise((o,s)=>{if(n.name.split(".")[1]==="md"){let l=new FileReader;l.readAsText(n,"UTF-8"),l.onloadend=async m=>{m.target.readyState!==2&&s({msg:"文件读写失败"});let c=qe(m.target.result.toString().split(`
`)),{userid:v}=JSON.parse(sessionStorage.getItem("user")),_=await ce({fileid:a,userid:v,content:c});_.code!==200&&s(_),o(_)}}});function qe(n,a){let u=[];return n.forEach(o=>{let s=o&&o.match(/^[#]+|[*]+[\u4e00-\u9fa5|\d|a-z|A-Z|-]|[~~~]{3}|[<][u][>]|[\]][(]/g);if(!s)return u.push({insert:L(o)});let t=null;s.forEach(l=>{l.toString().includes("#")&&(t=l.length)}),u.push({insert:L(o),attributes:{header:t}})}),JSON.stringify(u)}function L(n){return n.replace(/[']/g,"#[d]#").replace(/["]/g,"#[s]#").replace(/^#+/g,"")}const x=n=>(j("data-v-524b9165"),n=n(),K(),n),Je={class:"top-left"},De=x(()=>e("i",{class:"iconfont icon-xinjian"},null,-1)),Le=x(()=>e("span",null,"新建",-1)),Pe=x(()=>e("i",{class:"iconfont icon-daoru"},null,-1)),je=x(()=>e("span",null,"导入",-1)),Ke=x(()=>e("i",{class:"iconfont icon-duqumoban"},null,-1)),Ue=x(()=>e("span",null,"模板",-1)),We=x(()=>e("i",{class:"iconfont icon-gongneng"},null,-1)),Ze=x(()=>e("span",null,"工具箱",-1)),Ge={class:"top-right"},Qe={class:"top-right-vip"},Xe=x(()=>e("i",{class:"iconfont icon-zuanshi"},null,-1)),Ye={class:"top-right-message",style:{"margin-right":"20px"}},et=x(()=>e("i",{class:"iconfont icon-xiaoxizhongxin"},null,-1)),tt={class:"top-right-user"},nt=["innerHTML"],st={key:2,class:"iconfont icon-tipvip"},ot={__name:"top",setup(n){const a=C("【双十一】超值活动，会员低至0.5元/天！");let u=C(!0),o=C("");const s=A([{name:"个人中心",command:"user",icon:"icon-zhanghao"},{name:"系统设置",command:"setting",icon:"icon-shezhi-xianxing"},{name:"项目地址",command:"gitee",icon:"icon-github-fill"},{name:"退出系统",command:"exit",icon:"icon-tuichu"}]),t=A({show:!1}),l=i=>{switch(i){case"user":$.push("/user");break;case"gitee":window.open("https://gitee.com/wfeng0/mpoe");break;case"setting":t.show=!0;break;case"exit":sessionStorage.clear(),$.push("/login");break}},m=()=>$.push("/template");let c=C(null),v=C(!1);const _=async i=>{v.value=!0,await oe(),c.value.showContentMenu(i,!0)},Z=()=>v.value=!1,G=i=>z.commit("setTopCreateData",i);let B=C(null);const Q=async i=>{const h=i.target.files[0];try{await D.confirm(`确认上传 ${h.name} 进行协同吗？`,"文件上传",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),X(h)}catch{k.info("已取消")}B.value.value=""},X=async i=>{let h=JSON.parse(sessionStorage.getItem("user")).userid,w=i.name.split(".")[0],b=i.name.split(".")[1],F={md:"markdown",txt:"txt",doc:"word",docx:"word",xls:"excel",xlsx:"excel"}[b],M=$.currentRoute.value.query.folderid,Y=Math.random().toString().split(".")[1].slice(0,3),I=await re({userid:h,filename:w,filesuffix:b,filetype:F,fileownerfolderid:M});if(I.code!==200)return k.error("导入失败，"+I.msg);k.success("文件导入成功！");let ee={id:I.data,name:Y,suffix:b,type:F};z.commit("setTopCreateData",ee);let N=await Ee(i,I.data,"Typora");if(N.code!==200)return k.error(N.msg);k.success(N.msg);try{await D.confirm("是否立即打开文件？","打开文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});let q={filename:w,filesuffix:b,filetype:F,owner:h};$.push({path:b==="xlsx"?`/excel/${I.data}`:`/edit/${I.data}`,query:q})}catch{k.info("已取消")}};return se(()=>{let i=JSON.parse(sessionStorage.getItem("user"));u.value=i.vip,o.value=i.userimg}),(i,h)=>{const w=g("el-button"),b=g("el-link"),E=g("el-badge"),F=g("el-avatar");return f(),S("div",{class:"top",onClick:h[2]||(h[2]=V((...M)=>i.hiddenContentMenu&&i.hiddenContentMenu(...M),["stop"]))},[e("div",Je,[r(w,{type:"primary",onClick:h[0]||(h[0]=V(M=>_(M),["stop"]))},{default:d(()=>[De,Le]),_:1}),r(w,{text:"",onClick:h[1]||(h[1]=V(M=>y(B).click(),["stop"]))},{default:d(()=>[Pe,je]),_:1}),r(w,{text:"",onClick:m},{default:d(()=>[Ke,Ue]),_:1}),r(w,{text:""},{default:d(()=>[We,Ze]),_:1})]),e("div",Ge,[e("div",Qe,[r(b,{type:"danger"},{default:d(()=>[Xe,e("span",null,H(a.value),1)]),_:1})]),e("div",Ye,[r(E,{value:"",class:"item"},{default:d(()=>[et]),_:1})]),e("div",tt,[r(He,{list:s,onCommand:l},{content:d(()=>[y(o)?(f(),S("div",{key:0,class:"userimg_svg",innerHTML:y(o)},null,8,nt)):(f(),R(F,{key:1,shape:"square",src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"})),y(u)?(f(),S("i",st)):J("",!0)]),_:1},8,["list"])])]),y(v)?(f(),R(de,{key:0,ref_key:"contentmenuRef",ref:c,onCreate:G,onClose:Z},null,512)):J("",!0),e("input",{type:"file",onChange:Q,style:{display:"none"},accept:"*",ref_key:"inputRef",ref:B},null,544)])}}},at=O(ot,[["__scopeId","data-v-524b9165"]]);const it={class:"home"},lt={class:"home-main"},ct={__name:"index",setup(n){let a=A([{title:"首页",path:"/home/pages"}]),u=[{path:"news",title:"最近文档"},{path:"share",title:"与我共享"},{path:"favor",title:"我的收藏"},{path:"messageCentre",title:"消息中心"}],o=C("pages");return P($.currentRoute,s=>{let t=s.path.split("/")[2];o=t;let l=u.find(m=>m.path===t);a.length===1&&t==="pages"||(a.length>1&&a.pop(),l&&a.push({title:l.title,path:`/home/${l.path}`}))},{deep:!0,immediate:!0}),(s,t)=>{const l=g("el-breadcrumb-item"),m=g("el-breadcrumb"),c=g("router-view");return f(),S("div",it,[r(Oe,{activeMenu:y(o)},null,8,["activeMenu"]),e("div",lt,[r(at),r(m,{class:"home-main-bread","separator-icon":y(ie)},{default:d(()=>[(f(!0),S(U,null,W(y(a),(v,_)=>(f(),R(l,{key:_,to:{path:v.path}},{default:d(()=>[ae(H(v.title),1)]),_:2},1032,["to"]))),128))]),_:1},8,["separator-icon"]),r(c,{style:{flex:"auto",padding:"10px 20px"}})])])}}},_t=O(ct,[["__scopeId","data-v-2c0ba73c"]]);export{_t as default};
