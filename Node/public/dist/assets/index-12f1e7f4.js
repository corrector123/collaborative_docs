import{_ as se,r as _,a as D,o as w,h as q,e as m,d as g,x as $,t as H,b as P,c as R,p as oe,F as j,i as ne,u as x,v as S,k as G,w as le,f as A,l as de,m as J,q as ae,z as fe,n as ce,A as pe,B as me,C as _e,g as re}from"./index-2dae8f78.js";import{C as ge}from"./index-521af508.js";import{f as ve}from"./filecontentmenu-6adbe480.js";import{g as ie,u as ye,a as he}from"./index-4194ef73.js";import{f as be}from"./index-e3b7fbbe.js";import{C as xe}from"./index-74b89282.js";import{s as we}from"./index-6b46918e.js";import{c as Ie}from"./share-120db684.js";import{e as ke}from"./execcontent-0635da60.js";import"./index-1adbd7d5.js";const Ce={__name:"FilePropertiesDialog",setup(o,{expose:V}){const I=_(!1),b=_({});return V({show:async v=>{try{const y=await ie({fileid:v});b.value=y.data,I.value=!0}finally{}}}),(v,y)=>{const d=D("el-descriptions-item"),C=D("el-descriptions"),r=D("el-dialog");return w(),q(r,{modelValue:I.value,"onUpdate:modelValue":y[0]||(y[0]=n=>I.value=n),title:"文件属性",width:"500px"},{default:m(()=>[g(C,{column:1,border:""},{default:m(()=>[g(d,{label:"文件名"},{default:m(()=>[$(H(b.value.filename),1)]),_:1}),g(d,{label:"类型"},{default:m(()=>[$(H(b.value.filetype)+"文件（."+H(b.value.filesuffix)+"） ",1)]),_:1}),g(d,{label:"所有者"},{default:m(()=>[$(H(b.value.owner),1)]),_:1}),g(d,{label:"创建时间"},{default:m(()=>[$(H(b.value.createtime),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},De=se(Ce,[["__scopeId","data-v-34b90c74"]]),Q={EDITOR:{value:"edit",label:"编辑者",description:"可以查看和编辑文件"},VIEWER:{value:"read",label:"只读观众",description:"仅可查看文件"}},Me=()=>[Q.EDITOR,Q.VIEWER];const Ve={class:"dialog-item"},Ee={key:0,class:"dialog-item"},Re={class:"dialog-item"},Se={class:"dialog-footer"},Pe={__name:"shareDialog",setup(o,{expose:V}){const I=_(!1),b=_("user"),i=_(""),v=_(Q.VIEWER.value),y=Me(),d=_(""),C=_(""),r=_(""),n=_({}),s=async(c,l,E)=>{try{const F=await ie({fileid:c});n.value=F.data,I.value=!0,i.value="",d.value=n.value.fileid,r.value=E,C.value=l,v.value=Q.VIEWER.value}finally{}},f=c=>{c()},k=async()=>{if(b.value==="user"){if(!i.value)return S.warning("请输入用户ID");try{const c=await be({targetUserId:i.value});if(c.code===2002)return S.error(c.msg||"用户不存在！");const l=await we({userId:i.value,fileId:d.value,permissionType:v.value});if(l.code!==200)return l.code===400?S.error(l.msg||"用户不存在！"):S.error("设置权限失败");await T(i.value),S.success("分享消息已发送！"),I.value=!1}catch(c){console.error("查询用户出错：",c),S.error("查询用户失败，请稍后重试")}}else{const c=n.value.filename+"."+n.value.filesuffix;let l=Ie(C.value,r.value,d.value,c,v.value);return ke(l),S.success("分享链接已复制到粘贴板")}I.value=!1},T=async c=>{try{const l=await xe({userid:0,targetId:c,fileId:d.value,permissionType:v.value});if(l.code===200)return console.log("邀请创建成功"),l.data;throw console.error("创建邀请失败:",l.message),new Error(l.message)}catch(l){throw console.error("API调用出错:",l),l}};return V({openDialog:s}),(c,l)=>{const E=D("el-radio"),F=D("el-radio-group"),U=D("el-input"),M=D("el-button"),W=D("el-dialog");return w(),q(W,{modelValue:I.value,"onUpdate:modelValue":l[4]||(l[4]=u=>I.value=u),title:"分享设置",width:"500px","before-close":f},{footer:m(()=>[P("span",Se,[g(M,{onClick:l[3]||(l[3]=u=>I.value=!1)},{default:m(()=>l[10]||(l[10]=[$("取消")])),_:1,__:[10]}),g(M,{type:"primary",onClick:k},{default:m(()=>l[11]||(l[11]=[$("确定")])),_:1,__:[11]})])]),default:m(()=>[P("div",Ve,[l[7]||(l[7]=P("span",{class:"label"},"分享方式：",-1)),g(F,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=u=>b.value=u)},{default:m(()=>[g(E,{label:"user"},{default:m(()=>l[5]||(l[5]=[$("分享给指定用户")])),_:1,__:[5]}),g(E,{label:"link"},{default:m(()=>l[6]||(l[6]=[$("生成分享链接")])),_:1,__:[6]})]),_:1},8,["modelValue"])]),b.value==="user"?(w(),R("div",Ee,[l[8]||(l[8]=P("span",{class:"label"},"分享给用户ID：",-1)),g(U,{modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=u=>i.value=u),placeholder:"请输入用户ID",clearable:""},null,8,["modelValue"])])):oe("",!0),P("div",Re,[l[9]||(l[9]=P("span",{class:"label"},"设置权限：",-1)),g(F,{modelValue:v.value,"onUpdate:modelValue":l[2]||(l[2]=u=>v.value=u)},{default:m(()=>[(w(!0),R(j,null,ne(x(y),u=>(w(),q(E,{key:u.value,label:u.value},{default:m(()=>[$(H(u.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue"])}}},$e=se(Pe,[["__scopeId","data-v-3e08b2bb"]]),Fe=()=>{let o=G({isDragging:!1,dom:null,startX:0,startY:0,endX:0,endY:0,mode:"inside"}),V=G([]);function I(r){if(r.button===2)return;o.isDragging=!0,o.dom=document.querySelector(".mask"),o.dom.style.display="block",o.dom.style.width=0,o.dom.style.height=0;let{x:n,y:s}=v(r);o.startX=n,o.startY=s,o.dom.style.left=`${n}px`,o.dom.style.top=`${s}px`}function b(r){if(!o.isDragging)return;let{x:n,y:s}=v(r);n-o.startX<0&&(o.dom.style.left=`${n}px`),s-o.startY<0&&(o.dom.style.top=`${s}px`),o.dom.style.height=`${Math.abs(s-o.startY)}px`,o.dom.style.width=`${Math.abs(n-o.startX)}px`}async function i(r){if(r.button===2)return;let{x:n,y:s}=v(r);o.endX=n,o.endY=s;let f=await y();V.length=0,f.forEach(k=>{V.push(k),document.querySelector(`#${k}`).classList.add("ischoosed")}),o.isDragging=!1,o.dom.style.display="none",o.dom=null,o.startX=0,o.startY=0,o.endX=0,o.endY=0}function v(r){let{offsetLeft:n,offsetTop:s}=document.querySelector(".pages"),{clientX:f,clientY:k}=r;return{x:f-n,y:k-s}}function y(){return new Promise((r,n)=>{let{startX:s,startY:f,endX:k,endY:T}=o,c=Math.abs(s),l=Math.abs(f),E=Math.abs(k),F=Math.abs(T),U=[Math.min(c,E),Math.max(c,E)],M=[Math.min(l,F),Math.max(l,F)],W=[];document.querySelectorAll(".pages-list-files-item").forEach(u=>{u.classList.remove("ischoosed");let[N,Z,ee,te]=d(u),L=C(N,U,M),O=C(Z,U,M),K=C(ee,U,M),z=C(te,U,M);function t(){(L||O||K||z)&&W.push(u.id)}function e(){L&&O&&K&&z&&W.push(u.id)}o.mode==="inside"?t():e()}),r(W)})}function d(r){let n=[],{offsetLeft:s,offsetTop:f,offsetWidth:k,offsetHeight:T}=r;return n.push({x:s,y:f}),n.push({x:s+k,y:f}),n.push({x:s+k,y:f+T}),n.push({x:s,y:f+T}),n}function C(r,n,s){let f=r.x>=n[0]&&r.x<=n[1],k=r.y>=s[0]&&r.y<=s[1];return f&&k}return{mouseDownHandle:I,mouseUpHandle:i,mouseMoveHandle:b,choosedDomID:V}};const Ae={class:"pages-list"},He={key:0,class:"pages-list-filesbread"},Te={class:"pages-list-files"},Ue=["onDblclick","onContextmenu","id"],We=["data-fileid","data-filename","data-filesuffix"],Xe=["onDblclick"],Ye=["onDblclick"],qe={__name:"index",setup(o){const{mouseDownHandle:V,mouseUpHandle:I,mouseMoveHandle:b}=Fe();var i=G([]);const v=_(null);let y=_(""),d=_(null),C=_(null),r=_(null);const n=_(null);let s=G([]),f=_("");le(()=>re.state.searchKeyWord,t=>f.value=t,{immediate:!1,deep:!0}),le(()=>re.state.topCreateData,t=>O(t),{immediate:!1,deep:!0});const k=(t,e)=>{if(e==="folder")return"#ffd153";let p={docx:"#0f90e3",xlsx:"#01a408",pdf:"#ea5454",txt:"rgba(0, 0, 0, 0.6)",md:"#5A96DB"};return p[t]?p[t]:""},T=t=>{M(i[t])},c=t=>{n.value.show(t.fileid)},l=(t,e,p)=>{r.value.openDialog(t,e,p)},E=(t,e)=>{const{type:p}=e,h={folder:()=>{F(e),A.replace({query:{folderid:e.folderid,fromPath:A.currentRoute.value.query.folderid}})},word:()=>A.push(`/word/${e.fileid}`),excel:()=>A.push(`/excel/${e.fileid}`),markdown:()=>A.push(`/edit/${e.fileid}`),txt:()=>A.push(`/edit/${e.fileid}`)};h[p]&&h[p]()},F=t=>{s.push({name:t.foldername}),sessionStorage.setItem("pagelistbread",JSON.stringify(s))},U=()=>{s.pop(),A.replace({query:{folderid:A.currentRoute.value.query.fromPath}})},M=async t=>{i.forEach(e=>e.changeflag=!1),t.changeflag=!0,await ae(),v.value[0].focus()},W=async()=>{let t="";if(i.forEach(e=>{e.changeflag&&(t=e.fileid,e.folderid,e.filename=y.value||e.filename,e.changeflag=!1)}),y.value){let e=t?await ye({fileid:t,newfilename:y.value}):{code:0,msg:"暂未实现文件夹更新"};e.code===200?S.success(e.msg):S.error(e.msg)}y.value=""},u=()=>v.value[0].blur();let N=_(!1);const Z=async t=>{N.value=!0,await ae(),d.value.showContentMenu(t),C.value.hiddenContentMenu()},ee=()=>{N.value=!1},te=()=>{d.value&&d.value.hiddenContentMenu(),C.value.hiddenContentMenu()},L=(t,e)=>(C.value.showContentMenu(t,e),d.value&&d.value.hiddenContentMenu()),O=({name:t,id:e,type:p,suffix:h})=>{if(p==="folder")return i.push({type:"folder",foldername:t,folderid:e,icon:"icon-24gf-folderOpen"});let Y={md:"icon-file-markdown1",txt:"icon-wenben1",xlsx:"icon-excel",docx:"icon-Word"};i.push({type:p,fileid:e,filename:t,filesuffix:h,suffix:h,icon:Y[h]})},K=t=>{i.splice(i.findIndex(e=>e.fileid===t),1)},z=t=>{const e={md:{type:"markdown",icon:"icon-file-markdown1"},txt:{type:"txt",icon:"icon-wenben1"},xlsx:{type:"excel",icon:"icon-excel"},docx:{type:"word",icon:"icon-Word"},folder:{type:"folder",icon:"icon-24gf-folderOpen"}};function p(h){h&&(t.type=e[h].type,t.icon=e[h].icon)}t.folderid?p("folder"):p(t.filesuffix),t.suffix=t.filesuffix};return le(A.currentRoute,async t=>{if(t.path!="/home/pages")return;i.length=0;let{userid:e}=JSON.parse(sessionStorage.getItem("user")),{folderid:p}=t.query;p||(s.length=0,sessionStorage.setItem("pagelistbread",[]));let h=await he({userid:e,folderid:p});if(h.code!==200)return S.error(h.msg);h.data.length&&h.data.forEach(Y=>{z(Y),i.push(Y)})},{immediate:!0,deep:!0}),de(()=>{let t=sessionStorage.getItem("pagelistbread");t&&JSON.parse(t).forEach(e=>s.push(e))}),(t,e)=>{const p=D("el-icon"),h=D("el-breadcrumb-item"),Y=D("el-breadcrumb"),ue=D("el-input");return w(),R("div",{id:"pages",class:"pages",onClick:te,onContextmenu:J(Z,["prevent","stop"]),onMousedown:e[1]||(e[1]=(...a)=>x(V)&&x(V)(...a)),onMouseup:e[2]||(e[2]=(...a)=>x(I)&&x(I)(...a)),onMousemove:e[3]||(e[3]=(...a)=>x(b)&&x(b)(...a))},[e[4]||(e[4]=P("div",{class:"mask"},null,-1)),x(N)?(w(),q(ge,{key:0,ref_key:"contentmenuRef",ref:d,onCreate:O,onClose:ee},null,512)):oe("",!0),g(ve,{ref_key:"filecontentmenuRef",ref:C,onPutFileToRecycle:K,onRename:T,onShowProperties:c,onShowShareWindow:l,fileList:x(i)},null,8,["fileList"]),g(De,{ref_key:"propertiesDialog",ref:n},null,512),g($e,{ref_key:"shareDialog",ref:r},null,512),P("div",Ae,[x(s).length?(w(),R("div",He,[g(p,{onClick:U},{default:m(()=>[g(x(fe))]),_:1}),g(Y,{separator:"/"},{default:m(()=>[(w(!0),R(j,null,ne(x(s),(a,B)=>(w(),q(h,{key:B},{default:m(()=>[$(H(a.name),1)]),_:2},1024))),128))]),_:1})])):oe("",!0),P("div",Te,[(w(!0),R(j,null,ne(x(i).filter(a=>!x(f)||(a.filename||a.foldername).includes(x(f))),(a,B)=>(w(),R("div",{onDblclick:X=>E(B,a),onContextmenu:J(X=>L(X,B),["prevent","stop"]),class:"pages-list-files-item",key:B,id:a.fileid||a.folderid},[P("i",{"data-fileid":a.fileid,"data-filename":a.filename,"data-filesuffix":a.suffix||a.filesuffix,class:ce(["iconfont",a.icon]),style:pe({color:k(a.suffix,a.type)})},null,14,We),a.changeflag?(w(),q(ue,{key:1,ref_for:!0,ref_key:"inputRef",ref:v,onBlur:W,onKeydown:me(u,["enter"]),modelValue:x(y),"onUpdate:modelValue":e[0]||(e[0]=X=>_e(y)?y.value=X:y=X)},null,8,["modelValue"])):(w(),R(j,{key:0},[a.type==="folder"?(w(),R("span",{key:0,onDblclick:J(X=>M(a),["stop"])},H(a.foldername),41,Xe)):(w(),R("span",{key:1,onDblclick:J(X=>M(a),["stop"])},H(a.filename+"."+a.suffix),41,Ye))],64))],40,Ue))),128))])])],32)}}},Ze=se(qe,[["__scopeId","data-v-afbcc144"]]);export{Ze as default};
