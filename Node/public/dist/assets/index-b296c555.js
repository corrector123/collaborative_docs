import{_ as B,r as b,w as D,a as f,o as h,c as k,b as e,d,e as u,u as v,s as te,n as T,f as C,g as F,p as P,h as K,i as z,F as U,j as W,t as A,k as ne,l as H,m as se,q as N,v as J,x as oe,E as L,y as I,z as ae,A as ie}from"./index-296aaede.js";import{C as le}from"./index-76bd977c.js";import{s as ce,c as re}from"./index-1e515c34.js";import"./index-2096a9ce.js";const p=n=>(P("data-v-0c7b257b"),n=n(),K(),n),de={class:"aside"},ue=p(()=>e("div",{class:"aside-logo"},[e("i",{class:"iconfont icon-circulation"}),e("span",{title:"多人协作编辑器"}," 多人协作编辑器 ")],-1)),_e={class:"aside-search"},pe=p(()=>e("i",{class:"iconfont icon-shouye-zhihui"},null,-1)),me=p(()=>e("span",null," 首页 ",-1)),he=[pe,me],fe=p(()=>e("i",{class:"iconfont icon-zuijinchangyong"},null,-1)),ge=p(()=>e("span",null," 最近文档 ",-1)),ve=[fe,ge],ye=p(()=>e("i",{class:"iconfont icon-shujugongxiang"},null,-1)),xe=p(()=>e("span",null," 与我共享 ",-1)),we=[ye,xe],be=p(()=>e("i",{class:"iconfont icon-shoucang2"},null,-1)),Ce=p(()=>e("span",null," 我的收藏 ",-1)),$e=[be,Ce],ke=p(()=>e("i",{class:"iconfont icon-xiaoxizhongxin"},null,-1)),Me=p(()=>e("span",null," 消息中心 ",-1)),Se=[ke,Me],Ie=p(()=>e("i",{class:"iconfont icon-huishouzhan"},null,-1)),Te=p(()=>e("span",null," 回收站 ",-1)),Re=[Ie,Te],ze={__name:"aside",props:{activeMenu:{type:String,default:"pages"}},setup(n){const o=b("");D(o,s=>F.commit("setSearchKeyWord",s));const i=s=>C.push(`/home/${s}`);return(s,t)=>{const c=f("el-icon"),r=f("el-input");return h(),k("div",de,[ue,e("div",_e,[d(r,{placeholder:"搜索",modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=a=>o.value=a),clearable:""},{prefix:u(()=>[d(c,null,{default:u(()=>[d(v(te))]),_:1})]),_:1},8,["modelValue"])]),e("div",{class:T(["aside-icon",{active:n.activeMenu==="pages"}]),onClick:t[1]||(t[1]=a=>i("pages"))},he,2),e("div",{class:T(["aside-icon",{active:n.activeMenu==="news"}]),onClick:t[2]||(t[2]=a=>i("news"))},ve,2),e("div",{class:T(["aside-icon",{active:n.activeMenu==="share"}]),onClick:t[3]||(t[3]=a=>i("share"))},we,2),e("div",{class:T(["aside-icon",{active:n.activeMenu==="favor"}]),onClick:t[4]||(t[4]=a=>i("favor"))},$e,2),e("div",{class:T(["aside-icon",{active:n.activeMenu==="messageCentre"}]),onClick:t[5]||(t[5]=a=>i("messageCentre"))},Se,2),e("div",{class:"aside-bottom",onClick:t[6]||(t[6]=a=>v(C).push("/recycle"))},Re)])}}},Be=B(ze,[["__scopeId","data-v-0c7b257b"]]);const Oe={style:{width:"100%",height:"100%"}},Ve={class:"dropdownItem"},Ne=["title"],Fe={__name:"index",props:{trigger:{type:String,default:"click"},list:{type:Array,default:()=>[]}},emits:["handleCommand","handleOpen","handleClose"],setup(n,{emit:o}){const i=c=>o("handleCommand",c),s=()=>o("handleOpen"),t=()=>o("handleClose");return(c,r)=>{const a=f("el-dropdown-item"),x=f("el-dropdown-menu"),g=f("el-dropdown");return h(),z(g,{trigger:n.trigger,onHandleOpen:s,onHandleClose:t,onCommand:i},{dropdown:u(()=>[d(x,null,{default:u(()=>[(h(!0),k(U,null,W(n.list,_=>(h(),z(a,{key:_.command,command:_.command},{default:u(()=>[e("div",Ve,[e("i",{class:T(["iconfont",_.icon])},null,2),e("span",{title:_.name},A(_.name),9,Ne)])]),_:2},1032,["command"]))),128))]),_:1})]),default:u(()=>[e("div",Oe,[ne(c.$slots,"content",{},void 0,!0)])]),_:3},8,["trigger"])}}},He=B(Fe,[["__scopeId","data-v-d3abf79c"]]),Ae=(n,o,i="Typora")=>new Promise((s,t)=>{if(n.name.split(".")[1]==="md"){let r=new FileReader;r.readAsText(n,"UTF-8"),r.onloadend=async a=>{a.target.readyState!==2&&t({msg:"文件读写失败"});let x=Ee(a.target.result.toString().split(`
`)),{userid:g}=JSON.parse(sessionStorage.getItem("user")),_=await ce({fileid:o,userid:g,content:x});_.code!==200&&t(_),s(_)}}});function Ee(n,o){let i=[];return n.forEach(s=>{let t=s&&s.match(/^[#]+|[*]+[\u4e00-\u9fa5|\d|a-z|A-Z|-]|[~~~]{3}|[<][u][>]|[\]][(]/g);if(!t)return i.push({insert:j(s)});let c=null;t.forEach(r=>{r.toString().includes("#")&&(c=r.length)}),i.push({insert:j(s),attributes:{header:c}})}),JSON.stringify(i)}function j(n){return n.replace(/[']/g,"#[d]#").replace(/["]/g,"#[s]#").replace(/^#+/g,"")}const y=n=>(P("data-v-524b9165"),n=n(),K(),n),qe={class:"top-left"},Je=y(()=>e("i",{class:"iconfont icon-xinjian"},null,-1)),Le=y(()=>e("span",null,"新建",-1)),je=y(()=>e("i",{class:"iconfont icon-daoru"},null,-1)),De=y(()=>e("span",null,"导入",-1)),Pe=y(()=>e("i",{class:"iconfont icon-duqumoban"},null,-1)),Ke=y(()=>e("span",null,"模板",-1)),Ue=y(()=>e("i",{class:"iconfont icon-gongneng"},null,-1)),We=y(()=>e("span",null,"工具箱",-1)),Ze={class:"top-right"},Ge={class:"top-right-vip"},Qe=y(()=>e("i",{class:"iconfont icon-zuanshi"},null,-1)),Xe={class:"top-right-message",style:{"margin-right":"20px"}},Ye=y(()=>e("i",{class:"iconfont icon-xiaoxizhongxin"},null,-1)),et={class:"top-right-user"},tt=["innerHTML"],nt={key:2,class:"iconfont icon-tipvip"},st={__name:"top",setup(n){const o=b("【双十一】超值活动，会员低至0.5元/天！");let i=b(!0),s=b("");const t=H([{name:"个人中心",command:"user",icon:"icon-zhanghao"},{name:"系统设置",command:"setting",icon:"icon-shezhi-xianxing"},{name:"项目地址",command:"gitee",icon:"icon-github-fill"},{name:"退出系统",command:"exit",icon:"icon-tuichu"}]),c=H({show:!1}),r=l=>{switch(l){case"user":C.push("/user");break;case"gitee":window.open("https://gitee.com/wfeng0/mpoe");break;case"setting":c.show=!0;break;case"exit":sessionStorage.clear(),C.push("/login");break}},a=()=>C.push("/template");let x=b(null),g=b(!1);const _=async l=>{g.value=!0,await oe(),x.value.showContentMenu(l,!0)},Z=()=>g.value=!1,G=l=>F.commit("setTopCreateData",l);let O=b(null);const Q=async l=>{const m=l.target.files[0];try{await L.confirm(`确认上传 ${m.name} 进行协同吗？`,"文件上传",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),X(m)}catch{I.info("已取消")}O.value.value=""},X=async l=>{let m=JSON.parse(sessionStorage.getItem("user")).userid,w=l.name.split(".")[0],$=l.name.split(".")[1],R={md:"markdown",txt:"txt",doc:"word",docx:"word",xls:"excel",xlsx:"excel"}[$],M=C.currentRoute.value.query.folderid,Y=Math.random().toString().split(".")[1].slice(0,3),S=await re({userid:m,filename:w,filesuffix:$,filetype:R,fileownerfolderid:M});if(S.code!==200)return I.error("导入失败，"+S.msg);I.success("文件导入成功！");let ee={id:S.data,name:Y,suffix:$,type:R};F.commit("setTopCreateData",ee);let V=await Ae(l,S.data,"Typora");if(V.code!==200)return I.error(V.msg);I.success(V.msg);try{await L.confirm("是否立即打开文件？","打开文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});let q={filename:w,filesuffix:$,filetype:R,owner:m};C.push({path:$==="xlsx"?`/excel/${S.data}`:`/edit/${S.data}`,query:q})}catch{I.info("已取消")}};return se(()=>{let l=JSON.parse(sessionStorage.getItem("user"));i.value=l.vip,s.value=l.userimg}),(l,m)=>{const w=f("el-button"),$=f("el-link"),E=f("el-badge"),R=f("el-avatar");return h(),k("div",{class:"top",onClick:m[2]||(m[2]=N((...M)=>l.hiddenContentMenu&&l.hiddenContentMenu(...M),["stop"]))},[e("div",qe,[d(w,{type:"primary",onClick:m[0]||(m[0]=N(M=>_(M),["stop"]))},{default:u(()=>[Je,Le]),_:1}),d(w,{text:"",onClick:m[1]||(m[1]=N(M=>v(O).click(),["stop"]))},{default:u(()=>[je,De]),_:1}),d(w,{text:"",onClick:a},{default:u(()=>[Pe,Ke]),_:1}),d(w,{text:""},{default:u(()=>[Ue,We]),_:1})]),e("div",Ze,[e("div",Ge,[d($,{type:"danger"},{default:u(()=>[Qe,e("span",null,A(o.value),1)]),_:1})]),e("div",Xe,[d(E,{value:"",class:"item"},{default:u(()=>[Ye]),_:1})]),e("div",et,[d(He,{list:t,onCommand:r},{content:u(()=>[v(s)?(h(),k("div",{key:0,class:"userimg_svg",innerHTML:v(s)},null,8,tt)):(h(),z(R,{key:1,shape:"square",src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"})),v(i)?(h(),k("i",nt)):J("",!0)]),_:1},8,["list"])])]),v(g)?(h(),z(le,{key:0,ref_key:"contentmenuRef",ref:x,onCreate:G,onClose:Z},null,512)):J("",!0),e("input",{type:"file",onChange:Q,style:{display:"none"},accept:"*",ref_key:"inputRef",ref:O},null,544)])}}},ot=B(st,[["__scopeId","data-v-524b9165"]]);const at={class:"home"},it={class:"home-main"},lt={__name:"index",setup(n){let o=H([{title:"首页",path:"/home/pages"}]),i=[{path:"news",title:"最近文档"},{path:"share",title:"与我共享"},{path:"favor",title:"我的收藏"},{path:"messageCentre",title:"消息中心"}],s=b("pages");return D(C.currentRoute,t=>{let c=t.path.split("/")[2];s=c;let r=i.find(a=>a.path===c);o.length===1&&c==="pages"||(o.length>1&&o.pop(),r&&o.push({title:r.title,path:`/home/${r.path}`}))},{deep:!0,immediate:!0}),(t,c)=>{const r=f("el-breadcrumb-item"),a=f("el-breadcrumb"),x=f("router-view");return h(),k("div",at,[d(Be,{activeMenu:v(s)},null,8,["activeMenu"]),e("div",it,[d(ot),d(a,{class:"home-main-bread","separator-icon":v(ie)},{default:u(()=>[(h(!0),k(U,null,W(v(o),(g,_)=>(h(),z(r,{key:_,to:{path:g.path}},{default:u(()=>[ae(A(g.title),1)]),_:2},1032,["to"]))),128))]),_:1},8,["separator-icon"]),d(x,{style:{flex:"auto",padding:"10px 20px"}})])])}}},_t=B(lt,[["__scopeId","data-v-2c0ba73c"]]);export{_t as default};
