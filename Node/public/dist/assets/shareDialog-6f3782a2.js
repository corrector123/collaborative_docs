import{g as F}from"./index-efbe094e.js";import{f as O}from"./index-3ebc8035.js";import{C as W}from"./index-088f85c9.js";import{s as L}from"./index-2ba7978a.js";import{c as M}from"./share-0dcfe04e.js";import{_ as j,r as s,a as v,o as _,i as P,e as t,b as g,d as i,z as f,c as h,v as S,F as z,j as $,u as q,t as G,y as u,p as H,h as J}from"./index-7a9b2843.js";const K=r=>{if(navigator.clipboard)navigator.clipboard.writeText(r);else{var l=document.createElement("textarea");document.body.appendChild(l),l.style.position="fixed",l.style.clip="rect(0 0 0 0)",l.style.top="10px",l.value=r,l.select(),document.execCommand("copy",!0),document.body.removeChild(l)}},V={EDITOR:{value:"edit",label:"编辑者",description:"可以查看和编辑文件"},VIEWER:{value:"read",label:"只读观众",description:"仅可查看文件"}},Q=()=>[V.EDITOR,V.VIEWER];const w=r=>(H("data-v-7be861b1"),r=r(),J(),r),X={class:"dialog-item"},Y=w(()=>g("span",{class:"label"},"分享方式：",-1)),Z={key:0,class:"dialog-item"},ee=w(()=>g("span",{class:"label"},"分享给用户ID：",-1)),ae={key:1,class:"dialog-item"},oe=w(()=>g("span",{class:"label"},"设置权限：",-1)),le={class:"dialog-footer"},se={__name:"shareDialog",setup(r,{expose:l}){const d=s(!1),I=s("user"),n=s(""),c=s(V.VIEWER.value),x=Q(),y=s(""),E=s(""),C=s(""),p=s({}),D=s(!1),R=async(a,e,m)=>{try{const b=await F({fileid:a});p.value=b.data,d.value=!0,n.value="",y.value=a,C.value=m,E.value=e,c.value=V.VIEWER.value,D.value=e===p.value.owner}finally{}},U=a=>{a()},T=async()=>{if(I.value==="user"){if(!n.value)return u.warning("请输入用户ID");try{const a=await O({targetUserId:n.value});if(a.code===2002)return u.error(a.msg||"用户不存在！");const e=await L({userId:n.value,fileId:y.value,permissionType:c.value,ownerId:p.value.owner});if(e.code!==200)return e.code===400?u.error(e.msg||"用户不存在！"):u.error("设置权限失败");await N(n.value),u.success("分享消息已发送！"),d.value=!1}catch(a){console.error("查询用户出错：",a),u.error("查询用户失败，请稍后重试")}}else{const a=p.value.filename+"."+p.value.filesuffix;let e=M(E.value,C.value,y.value,a,c.value);return K(e),u.success("分享链接已复制到粘贴板")}d.value=!1},N=async a=>{try{const e=await W({userid:0,targetId:a,fileId:y.value,permissionType:c.value});if(e.code===200)return console.log("邀请创建成功"),e.data;throw console.error("创建邀请失败:",e.message),new Error(e.message)}catch(e){throw console.error("API调用出错:",e),e}};return l({openDialog:R}),(a,e)=>{const m=v("el-radio"),b=v("el-radio-group"),A=v("el-input"),k=v("el-button"),B=v("el-dialog");return _(),P(B,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=o=>d.value=o),title:"分享设置",width:"500px","before-close":U},{footer:t(()=>[g("span",le,[i(k,{onClick:e[3]||(e[3]=o=>d.value=!1)},{default:t(()=>[f("取消")]),_:1}),i(k,{type:"primary",onClick:T},{default:t(()=>[f("确定")]),_:1})])]),default:t(()=>[g("div",X,[Y,i(b,{modelValue:I.value,"onUpdate:modelValue":e[0]||(e[0]=o=>I.value=o)},{default:t(()=>[i(m,{label:"user"},{default:t(()=>[f("分享给指定用户")]),_:1}),i(m,{label:"link"},{default:t(()=>[f("生成分享链接")]),_:1})]),_:1},8,["modelValue"])]),I.value==="user"?(_(),h("div",Z,[ee,i(A,{modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value=o),placeholder:"请输入用户ID",clearable:""},null,8,["modelValue"])])):S("",!0),D.value?(_(),h("div",ae,[oe,i(b,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=o=>c.value=o)},{default:t(()=>[(_(!0),h(z,null,$(q(x),o=>(_(),P(m,{key:o.value,label:o.value},{default:t(()=>[f(G(o.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])):S("",!0)]),_:1},8,["modelValue"])}}},ce=j(se,[["__scopeId","data-v-7be861b1"]]);export{K as e,ce as f,Q as g};
