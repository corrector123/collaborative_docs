import{g as F}from"./index-7f508c92.js";import{f as O}from"./index-6b1def2e.js";import{C as W}from"./index-b1a664e7.js";import{s as L}from"./index-bbf37d91.js";import{c as M}from"./share-51b121b5.js";import{_ as $,r as s,a as v,o as c,h as x,e as t,b as f,d as n,x as _,c as w,p as P,F as j,i as q,u as z,t as G,v as i}from"./index-e6bd9370.js";const H=b=>{if(navigator.clipboard)navigator.clipboard.writeText(b);else{var a=document.createElement("textarea");document.body.appendChild(a),a.style.position="fixed",a.style.clip="rect(0 0 0 0)",a.style.top="10px",a.value=b,a.select(),document.execCommand("copy",!0),document.body.removeChild(a)}},V={EDITOR:{value:"edit",label:"编辑者",description:"可以查看和编辑文件"},VIEWER:{value:"read",label:"只读观众",description:"仅可查看文件"}},J=()=>[V.EDITOR,V.VIEWER];const K={class:"dialog-item"},Q={key:0,class:"dialog-item"},X={key:1,class:"dialog-item"},Y={class:"dialog-footer"},Z={__name:"shareDialog",setup(b,{expose:a}){const u=s(!1),g=s("user"),r=s(""),d=s(V.VIEWER.value),R=J(),I=s(""),E=s(""),C=s(""),m=s({}),D=s(!1),U=async(l,e,p)=>{try{const y=await F({fileid:l});m.value=y.data,u.value=!0,r.value="",I.value=l,C.value=p,E.value=e,d.value=V.VIEWER.value,D.value=e===m.value.owner}finally{}},T=l=>{l()},N=async()=>{if(g.value==="user"){if(!r.value)return i.warning("请输入用户ID");try{const l=await O({targetUserId:r.value});if(l.code===2002)return i.error(l.msg||"用户不存在！");const e=await L({userId:r.value,fileId:I.value,permissionType:d.value,ownerId:m.value.owner});if(e.code!==200)return e.code===400?i.error(e.msg||"用户不存在！"):i.error("设置权限失败");await S(r.value),i.success("分享消息已发送！"),u.value=!1}catch(l){console.error("查询用户出错：",l),i.error("查询用户失败，请稍后重试")}}else{const l=m.value.filename+"."+m.value.filesuffix;let e=M(E.value,C.value,I.value,l,d.value);return H(e),i.success("分享链接已复制到粘贴板")}u.value=!1},S=async l=>{try{const e=await W({userid:0,targetId:l,fileId:I.value,permissionType:d.value});if(e.code===200)return console.log("邀请创建成功"),e.data;throw console.error("创建邀请失败:",e.message),new Error(e.message)}catch(e){throw console.error("API调用出错:",e),e}};return a({openDialog:U}),(l,e)=>{const p=v("el-radio"),y=v("el-radio-group"),A=v("el-input"),k=v("el-button"),B=v("el-dialog");return c(),x(B,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=o=>u.value=o),title:"分享设置",width:"500px","before-close":T},{footer:t(()=>[f("span",Y,[n(k,{onClick:e[3]||(e[3]=o=>u.value=!1)},{default:t(()=>e[10]||(e[10]=[_("取消")])),_:1,__:[10]}),n(k,{type:"primary",onClick:N},{default:t(()=>e[11]||(e[11]=[_("确定")])),_:1,__:[11]})])]),default:t(()=>[f("div",K,[e[7]||(e[7]=f("span",{class:"label"},"分享方式：",-1)),n(y,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=o=>g.value=o)},{default:t(()=>[n(p,{label:"user"},{default:t(()=>e[5]||(e[5]=[_("分享给指定用户")])),_:1,__:[5]}),n(p,{label:"link"},{default:t(()=>e[6]||(e[6]=[_("生成分享链接")])),_:1,__:[6]})]),_:1},8,["modelValue"])]),g.value==="user"?(c(),w("div",Q,[e[8]||(e[8]=f("span",{class:"label"},"分享给用户ID：",-1)),n(A,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value=o),placeholder:"请输入用户ID",clearable:""},null,8,["modelValue"])])):P("",!0),D.value?(c(),w("div",X,[e[9]||(e[9]=f("span",{class:"label"},"设置权限：",-1)),n(y,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value=o)},{default:t(()=>[(c(!0),w(j,null,q(z(R),o=>(c(),x(p,{key:o.value,label:o.value},{default:t(()=>[_(G(o.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])])):P("",!0)]),_:1},8,["modelValue"])}}},te=$(Z,[["__scopeId","data-v-6090156a"]]);export{te as f,J as g};
