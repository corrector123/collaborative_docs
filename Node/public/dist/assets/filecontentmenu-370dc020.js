import{_ as M,k as h,r as v,o as g,c as x,b as _,F as S,i as I,n as N,B,t as $,u as b,m as z,E as F,v as t}from"./index-e6bd9370.js";import{r as E,i as O,p as P}from"./index-7f508c92.js";const A=["onClick"],D={__name:"filecontentmenu",emits:["putFileToRecycle","rename","deleteFileFromRecycle","restoreFileFromRecycle","showProperties","showShareWindow"],setup(L,{expose:C,emit:T}){const m=T;let f=h([{name:"分享",icon:"icon-shujugongxiang",command:"shear"},{name:"删除",icon:"icon-huishouzhan",command:"delete"},{name:"重命名",icon:"icon-zhongmingming",command:"rename"},{name:"移动至",icon:"icon-yidong"},{name:"360压缩",icon:"icon-yasuobao",color:"#51BDF4"}]),w=v(!0),n=h({});const l=h({x:0,y:0,display:"none"});let p=v(0);const k=async(c,r)=>{let{username:i,userid:o}=JSON.parse(sessionStorage.getItem("user"));switch(r){case"shear":m("showShareWindow",n.fileid,o,i);break;case"delete":if(!n.fileid)return;try{await F.confirm(`确认删除 ${n.filename+"."+n.filesuffix} 吗？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});let{code:e,msg:s}=await P({fileid:n.fileid,userid:o});if(e!==200)return t.error(s);t.success(s),m("putFileToRecycle",n.fileid)}catch(e){if(e==="cancel"||e==="close"||e.message==="cancel")return;console.error("删除文件错误:",e),t.error("删除操作失败")}return;case"rename":return m("rename",p.value);case"delete_recycle":try{const e=n.filename||"未知文件",s=n.filesuffix||"",u=s?`${e}.${s}`:e;await F.confirm(`确认彻底删除 ${u} 吗？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const a=await O({fileid:n.fileid,userid:o});if(!a)return t.error("删除请求失败，无响应");const{code:y,msg:d}=a;if(y!==200)return t.error(d||"删除失败");t.success(d||"彻底删除成功"),m("deleteFileFromRecycle",n.fileid)}catch(e){if(e==="cancel"||e==="close"||e.message==="cancel")return;console.error("删除文件错误:",e),t.error("删除操作失败")}return;case"restore":try{const e=n.filename||"未知文件",s=n.filesuffix||"",u=s?`${e}.${s}`:e;await F.confirm(`确认恢复 ${u} 吗？`,"恢复文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const a=await E({fileid:n.fileid,userid:o});if(!a)return t.error("恢复请求失败，无响应");const{code:y,msg:d}=a;if(y!==200)return t.error(d||"恢复失败");t.success(d||"恢复成功"),m("restoreFileFromRecycle",n.fileid)}catch(e){if(e==="cancel"||e==="close"||e.message==="cancel")return;console.error("恢复文件错误:",e),t.error("恢复操作失败")}return}},R=c=>{w.value=!c.className.includes("icon-24gf-folderOpen");let{fileid:r,filename:i,filesuffix:o,folderid:e}=c.dataset;console.log("获取文件信息:",{fileid:r,filename:i,filesuffix:o,folderid:e}),n.fileid=r,n.folderid=e,n.filename=i,n.filesuffix=o,(!i||!o)&&console.warn("文件信息不完整:",{filename:i,filesuffix:o});let s={name:"打开",icon:"icon-24gf-folderOpen",color:"#FFD153"},u=f.find(a=>a.icon==="icon-24gf-folderOpen");w.value?u&&f.shift():u||f.unshift(s)};return C({showContentMenu:(c,r,i="")=>{i==="recycle"&&(f.length=0,f.push({name:"还原",icon:"icon-chexiao",command:"restore"},{name:"彻底删除",icon:"icon-huishouzhan",command:"delete_recycle"})),p.value=r;let{target:o}=c;R(o),l.x=o.offsetLeft+c.offsetX,l.y=o.offsetTop+c.offsetY,l.display="block"},hiddenContentMenu:()=>(l.display="none",p.value=0)}),(c,r)=>(g(),x("div",null,[_("div",{onContextmenu:r[0]||(r[0]=z(()=>{},["stop"])),class:"contentmenu",style:B({left:l.x+"px",top:l.y+"px",display:l.display})},[(g(!0),x(S,null,I(b(f),(i,o)=>(g(),x("div",{key:o,onClick:e=>k(e,i.command)},[_("i",{class:N(["iconfont",i.icon]),style:B({color:i.color})},null,6),_("span",null,$(i.name),1)],8,A))),128))],36)]))}},X=M(D,[["__scopeId","data-v-d22baa76"]]);export{X as f};
