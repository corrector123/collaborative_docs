import{_ as k,l as h,r as B,o as _,c as g,b as F,F as I,j as N,n as S,C,t as $,u as b,q as z,E as v,y as o}from"./index-d91e81a4.js";import{c as E}from"./share-cb6e644f.js";import{e as O}from"./execcontent-0635da60.js";import{r as A,i as D,p as L}from"./index-5154f5bc.js";const P=["onClick"],j={__name:"filecontentmenu",emits:["putFileToRecycle","rename","deleteFileFromRecycle","restoreFileFromRecycle"],setup(q,{expose:T,emit:p}){let a=h([{name:"分享",icon:"icon-shujugongxiang",command:"shear"},{name:"删除",icon:"icon-huishouzhan",command:"delete"},{name:"重命名",icon:"icon-zhongmingming",command:"rename"},{name:"移动至",icon:"icon-yidong"},{name:"360压缩",icon:"icon-yasuobao",color:"#51BDF4"}]),w=B(!0),e=h({});const l=h({x:0,y:0,display:"none"});let y=B(0);const R=async(r,c)=>{let{username:s,userid:t}=JSON.parse(sessionStorage.getItem("user"));switch(c){case"shear":let f=E(s,e.fileid,e.filename+"."+e.filesuffix);return O(f),o.success("分享链接已复制到粘贴板");case"delete":if(!e.fileid)return;try{await v.confirm(`确认删除 ${e.filename+"."+e.filesuffix} 吗？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});let{code:n,msg:i}=await L({fileid:e.fileid,userid:t});if(n!==200)return o.error(i);o.success(i),p("putFileToRecycle",e.fileid)}catch{o.info("已取消")}return;case"rename":return p("rename",y.value);case"delete_recycle":try{const n=e.filename||"未知文件",i=e.filesuffix||"",u=i?`${n}.${i}`:n;await v.confirm(`确认彻底删除 ${u} 吗？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const m=await D({fileid:e.fileid,userid:t});if(!m)return o.error("删除请求失败，无响应");const{code:x,msg:d}=m;if(x!==200)return o.error(d||"删除失败");o.success(d||"彻底删除成功"),p("deleteFileFromRecycle",e.fileid)}catch(n){if(n==="cancel"||n==="close"||n.message==="cancel")return;console.error("删除文件错误:",n),o.error("删除操作失败")}return;case"restore":try{const n=e.filename||"未知文件",i=e.filesuffix||"",u=i?`${n}.${i}`:n;await v.confirm(`确认恢复 ${u} 吗？`,"恢复文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const m=await A({fileid:e.fileid,userid:t});if(!m)return o.error("恢复请求失败，无响应");const{code:x,msg:d}=m;if(x!==200)return o.error(d||"恢复失败");o.success(d||"恢复成功"),p("restoreFileFromRecycle",e.fileid)}catch(n){if(n==="cancel"||n==="close"||n.message==="cancel")return;console.error("恢复文件错误:",n),o.error("恢复操作失败")}return}},M=r=>{w.value=!r.className.includes("icon-24gf-folderOpen");let{fileid:c,filename:s,filesuffix:t,folderid:f}=r.dataset;e.fileid=c,e.folderid=f,e.filename=s,e.filesuffix=t;let n={name:"打开",icon:"icon-24gf-folderOpen",color:"#FFD153"},i=a.find(u=>u.icon==="icon-24gf-folderOpen");w.value?i&&a.shift():i||a.unshift(n)};return T({showContentMenu:(r,c,s="")=>{s==="recycle"&&(a.length=0,a.push({name:"还原",icon:"icon-chexiao",command:"restore"},{name:"彻底删除",icon:"icon-huishouzhan",command:"delete_recycle"})),y.value=c;let{target:t}=r;M(t),l.x=t.offsetLeft+r.offsetX,l.y=t.offsetTop+r.offsetY,l.display="block"},hiddenContentMenu:()=>(l.display="none",y.value=0)}),(r,c)=>(_(),g("div",null,[F("div",{onContextmenu:c[0]||(c[0]=z(()=>{},["stop"])),class:"contentmenu",style:C({left:l.x+"px",top:l.y+"px",display:l.display})},[(_(!0),g(I,null,N(b(a),(s,t)=>(_(),g("div",{key:t,onClick:f=>R(f,s.command)},[F("i",{class:S(["iconfont",s.icon]),style:C({color:s.color})},null,6),F("span",null,$(s.name),1)],8,P))),128))],36)]))}},H=k(j,[["__scopeId","data-v-3eb52ef6"]]);export{H as f};
