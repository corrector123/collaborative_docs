import{_ as k,m as h,r as v,o as g,c as x,b as _,F as I,j as M,n as S,I as B,t as N,u as $,v as b,E as F,ar as z,z as t,as as E,at as O}from"./index-7d387833.js";const P=["onClick"],A={__name:"filecontentmenu",emits:["putFileToRecycle","rename","deleteFileFromRecycle","restoreFileFromRecycle","showProperties","showShareWindow"],setup(D,{expose:C,emit:d}){let f=h([{name:"分享",icon:"icon-shujugongxiang",command:"shear"},{name:"删除",icon:"icon-huishouzhan",command:"delete"},{name:"重命名",icon:"icon-zhongmingming",command:"rename"},{name:"移动至",icon:"icon-yidong"},{name:"360压缩",icon:"icon-yasuobao",color:"#51BDF4"}]),w=v(!0),n=h({});const l=h({x:0,y:0,display:"none"});let p=v(0);const T=async(c,r)=>{let{username:i,userid:o}=JSON.parse(sessionStorage.getItem("user"));switch(r){case"shear":d("showShareWindow",n.fileid,o,i);break;case"delete":if(!n.fileid)return;try{await F.confirm(`确认删除 ${n.filename+"."+n.filesuffix} 吗？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});let{code:e,msg:s}=await O({fileid:n.fileid,userid:o});if(e!==200)return t.error(s);t.success(s),d("putFileToRecycle",n.fileid)}catch(e){if(e==="cancel"||e==="close"||e.message==="cancel")return;console.error("删除文件错误:",e),t.error("删除操作失败")}return;case"rename":return d("rename",p.value);case"delete_recycle":try{const e=n.filename||"未知文件",s=n.filesuffix||"",u=s?`${e}.${s}`:e;await F.confirm(`确认彻底删除 ${u} 吗？`,"删除文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const a=await E({fileid:n.fileid,userid:o});if(!a)return t.error("删除请求失败，无响应");const{code:y,msg:m}=a;if(y!==200)return t.error(m||"删除失败");t.success(m||"彻底删除成功"),d("deleteFileFromRecycle",n.fileid)}catch(e){if(e==="cancel"||e==="close"||e.message==="cancel")return;console.error("删除文件错误:",e),t.error("删除操作失败")}return;case"restore":try{const e=n.filename||"未知文件",s=n.filesuffix||"",u=s?`${e}.${s}`:e;await F.confirm(`确认恢复 ${u} 吗？`,"恢复文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});const a=await z({fileid:n.fileid,userid:o});if(!a)return t.error("恢复请求失败，无响应");const{code:y,msg:m}=a;if(y!==200)return t.error(m||"恢复失败");t.success(m||"恢复成功"),d("restoreFileFromRecycle",n.fileid)}catch(e){if(e==="cancel"||e==="close"||e.message==="cancel")return;console.error("恢复文件错误:",e),t.error("恢复操作失败")}return}},R=c=>{w.value=!c.className.includes("icon-24gf-folderOpen");let{fileid:r,filename:i,filesuffix:o,folderid:e}=c.dataset;console.log("获取文件信息:",{fileid:r,filename:i,filesuffix:o,folderid:e}),n.fileid=r,n.folderid=e,n.filename=i,n.filesuffix=o,(!i||!o)&&console.warn("文件信息不完整:",{filename:i,filesuffix:o});let s={name:"打开",icon:"icon-24gf-folderOpen",color:"#FFD153"},u=f.find(a=>a.icon==="icon-24gf-folderOpen");w.value?u&&f.shift():u||f.unshift(s)};return C({showContentMenu:(c,r,i="")=>{i==="recycle"&&(f.length=0,f.push({name:"还原",icon:"icon-chexiao",command:"restore"},{name:"彻底删除",icon:"icon-huishouzhan",command:"delete_recycle"})),p.value=r;let{target:o}=c;R(o),l.x=o.offsetLeft+c.offsetX,l.y=o.offsetTop+c.offsetY,l.display="block"},hiddenContentMenu:()=>(l.display="none",p.value=0)}),(c,r)=>(g(),x("div",null,[_("div",{onContextmenu:r[0]||(r[0]=b(()=>{},["stop"])),class:"contentmenu",style:B({left:l.x+"px",top:l.y+"px",display:l.display})},[(g(!0),x(I,null,M($(f),(i,o)=>(g(),x("div",{key:o,onClick:e=>T(e,i.command)},[_("i",{class:S(["iconfont",i.icon]),style:B({color:i.color})},null,6),_("span",null,N(i.name),1)],8,P))),128))],36)]))}},J=k(A,[["__scopeId","data-v-d22baa76"]]);export{J as f};
