import{_ as ae,r as x,a as S,o as h,h as z,e as b,d as g,x as V,t as C,k as J,z as re,w as ee,f as v,l as de,c as M,b as K,u as p,p as ne,F as te,i as le,m as U,q as se,A as ue,n as fe,B as ce,C as pe,D as me,v as oe}from"./index-e6bd9370.js";import{C as he}from"./index-5e7284a1.js";import{f as _e}from"./filecontentmenu-370dc020.js";import{g as ge,u as ye,a as xe}from"./index-7f508c92.js";import{f as ve}from"./shareDialog-07bb5ca7.js";import"./index-0db453cb.js";import"./index-6b1def2e.js";import"./index-b1a664e7.js";import"./index-bbf37d91.js";import"./share-51b121b5.js";const be={__name:"FilePropertiesDialog",setup(o,{expose:w}){const k=x(!1),_=x({});return w({show:async r=>{try{const y=await ge({fileid:r});_.value=y.data,k.value=!0}finally{}}}),(r,y)=>{const f=S("el-descriptions-item"),m=S("el-descriptions"),l=S("el-dialog");return h(),z(l,{modelValue:k.value,"onUpdate:modelValue":y[0]||(y[0]=s=>k.value=s),title:"文件属性",width:"500px"},{default:b(()=>[g(m,{column:1,border:""},{default:b(()=>[g(f,{label:"文件名"},{default:b(()=>[V(C(_.value.filename),1)]),_:1}),g(f,{label:"类型"},{default:b(()=>[V(C(_.value.filetype)+"文件（."+C(_.value.filesuffix)+"） ",1)]),_:1}),g(f,{label:"所有者"},{default:b(()=>[V(C(_.value.owner),1)]),_:1}),g(f,{label:"创建时间"},{default:b(()=>[V(C(_.value.createtime),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])}}},we=ae(be,[["__scopeId","data-v-34b90c74"]]),ke=()=>{let o=J({isDragging:!1,dom:null,startX:0,startY:0,endX:0,endY:0,mode:"inside"}),w=J([]);function k(l){if(l.button===2)return;o.isDragging=!0,o.dom=document.querySelector(".mask"),o.dom.style.display="block",o.dom.style.width=0,o.dom.style.height=0;let{x:s,y:a}=r(l);o.startX=s,o.startY=a,o.dom.style.left=`${s}px`,o.dom.style.top=`${a}px`}function _(l){if(!o.isDragging)return;let{x:s,y:a}=r(l);s-o.startX<0&&(o.dom.style.left=`${s}px`),a-o.startY<0&&(o.dom.style.top=`${a}px`),o.dom.style.height=`${Math.abs(a-o.startY)}px`,o.dom.style.width=`${Math.abs(s-o.startX)}px`}async function R(l){if(l.button===2)return;let{x:s,y:a}=r(l);o.endX=s,o.endY=a;let i=await y();w.length=0,i.forEach(c=>{w.push(c),document.querySelector(`#${c}`).classList.add("ischoosed")}),o.isDragging=!1,o.dom.style.display="none",o.dom=null,o.startX=0,o.startY=0,o.endX=0,o.endY=0}function r(l){let{offsetLeft:s,offsetTop:a}=document.querySelector(".pages"),{clientX:i,clientY:c}=l;return{x:i-s,y:c-a}}function y(){return new Promise((l,s)=>{let{startX:a,startY:i,endX:c,endY:F}=o,A=Math.abs(a),B=Math.abs(i),N=Math.abs(c),T=Math.abs(F),$=[Math.min(A,N),Math.max(A,N)],H=[Math.min(B,T),Math.max(B,T)],D=[];document.querySelectorAll(".pages-list-files-item").forEach(P=>{P.classList.remove("ischoosed");let[j,X,G,Q]=f(P),L=m(j,$,H),W=m(X,$,H),Y=m(G,$,H),O=m(Q,$,H);function Z(){(L||W||Y||O)&&D.push(P.id)}function t(){L&&W&&Y&&O&&D.push(P.id)}o.mode==="inside"?Z():t()}),l(D)})}function f(l){let s=[],{offsetLeft:a,offsetTop:i,offsetWidth:c,offsetHeight:F}=l;return s.push({x:a,y:i}),s.push({x:a+c,y:i}),s.push({x:a+c,y:i+F}),s.push({x:a,y:i+F}),s}function m(l,s,a){let i=l.x>=s[0]&&l.x<=s[1],c=l.y>=a[0]&&l.y<=a[1];return i&&c}return{mouseDownHandle:k,mouseUpHandle:R,mouseMoveHandle:_,choosedDomID:w}};const Me={class:"pages-list"},Ce={key:0,class:"pages-list-filesbread"},De={class:"pages-list-files"},Ie=["onDblclick","onContextmenu","id"],Se=["data-fileid","data-filename","data-filesuffix"],Re=["onDblclick"],Fe=["onDblclick"],$e={__name:"index",setup(o){const{mouseDownHandle:w,mouseUpHandle:k,mouseMoveHandle:_}=ke(),R=re();var r=J([]);const y=x(null);let f=x(""),m=x(null),l=x(null),s=x(null);const a=x(null);let i=J([]),c=x("");ee(()=>R.state.searchKeyWord,t=>c.value=t,{immediate:!1,deep:!0}),ee(()=>R.state.topCreateData,t=>Y(t),{immediate:!1,deep:!0});const F=(t,e)=>{if(e==="folder")return"#ffd153";let d={docx:"#0f90e3",xlsx:"#01a408",pdf:"#ea5454",txt:"rgba(0, 0, 0, 0.6)",md:"#5A96DB"};return d[t]?d[t]:""},A=t=>{D(r[t])},B=t=>{a.value.show(t.fileid)},N=(t,e,d)=>{s.value.openDialog(t,e,d)},T=(t,e)=>{const{type:d}=e,u={folder:()=>{$(e),v.replace({query:{folderid:e.folderid,fromPath:v.currentRoute.value.query.folderid}})},word:()=>{R.dispatch("setEditorMode",{fileId:e.fileid,isReadOnly:!1}),v.push(`/word/${e.fileid}`)},excel:()=>v.push(`/excel/${e.fileid}`),markdown:()=>v.push(`/edit/${e.fileid}`),txt:()=>v.push(`/edit/${e.fileid}`)};u[d]&&u[d]()},$=t=>{i.push({name:t.foldername}),sessionStorage.setItem("pagelistbread",JSON.stringify(i))},H=()=>{i.pop(),v.replace({query:{folderid:v.currentRoute.value.query.fromPath}})},D=async t=>{r.forEach(e=>e.changeflag=!1),t.changeflag=!0,await se(),y.value[0].focus()},P=async()=>{let t="";if(r.forEach(e=>{e.changeflag&&(t=e.fileid,e.folderid,e.filename=f.value||e.filename,e.changeflag=!1)}),f.value){let e=t?await ye({fileid:t,newfilename:f.value}):{code:0,msg:"暂未实现文件夹更新"};e.code===200?oe.success(e.msg):oe.error(e.msg)}f.value=""},j=()=>y.value[0].blur();let X=x(!1);const G=async t=>{X.value=!0,await se(),m.value.showContentMenu(t),l.value.hiddenContentMenu()},Q=()=>{X.value=!1},L=()=>{m.value&&m.value.hiddenContentMenu(),l.value.hiddenContentMenu()},W=(t,e)=>(l.value.showContentMenu(t,e),m.value&&m.value.hiddenContentMenu()),Y=({name:t,id:e,type:d,suffix:u})=>{if(d==="folder")return r.push({type:"folder",foldername:t,folderid:e,icon:"icon-24gf-folderOpen"});let E={md:"icon-file-markdown1",txt:"icon-wenben1",xlsx:"icon-excel",docx:"icon-Word"};r.push({type:d,fileid:e,filename:t,filesuffix:u,suffix:u,icon:E[u]})},O=t=>{r.splice(r.findIndex(e=>e.fileid===t),1)},Z=t=>{const e={md:{type:"markdown",icon:"icon-file-markdown1"},txt:{type:"txt",icon:"icon-wenben1"},xlsx:{type:"excel",icon:"icon-excel"},docx:{type:"word",icon:"icon-Word"},folder:{type:"folder",icon:"icon-24gf-folderOpen"}};function d(u){u&&(t.type=e[u].type,t.icon=e[u].icon)}t.folderid?d("folder"):d(t.filesuffix),t.suffix=t.filesuffix};return ee(v.currentRoute,async t=>{if(t.path!="/home/pages")return;r.length=0;let{userid:e}=JSON.parse(sessionStorage.getItem("user")),{folderid:d}=t.query;d||(i.length=0,sessionStorage.setItem("pagelistbread",[]));let u=await xe({userid:e,folderid:d});if(u.code!==200)return oe.error(u.msg);u.data.length&&u.data.forEach(E=>{Z(E),r.push(E)})},{immediate:!0,deep:!0}),de(()=>{let t=sessionStorage.getItem("pagelistbread");t&&JSON.parse(t).forEach(e=>i.push(e))}),(t,e)=>{const d=S("el-icon"),u=S("el-breadcrumb-item"),E=S("el-breadcrumb"),ie=S("el-input");return h(),M("div",{id:"pages",class:"pages",onClick:L,onContextmenu:U(G,["prevent","stop"]),onMousedown:e[1]||(e[1]=(...n)=>p(w)&&p(w)(...n)),onMouseup:e[2]||(e[2]=(...n)=>p(k)&&p(k)(...n)),onMousemove:e[3]||(e[3]=(...n)=>p(_)&&p(_)(...n))},[e[4]||(e[4]=K("div",{class:"mask"},null,-1)),p(X)?(h(),z(he,{key:0,ref_key:"contentmenuRef",ref:m,onCreate:Y,onClose:Q},null,512)):ne("",!0),g(_e,{ref_key:"filecontentmenuRef",ref:l,onPutFileToRecycle:O,onRename:A,onShowProperties:B,onShowShareWindow:N,fileList:p(r)},null,8,["fileList"]),g(we,{ref_key:"propertiesDialog",ref:a},null,512),g(ve,{ref_key:"shareDialog",ref:s},null,512),K("div",Me,[p(i).length?(h(),M("div",Ce,[g(d,{onClick:H},{default:b(()=>[g(p(ue))]),_:1}),g(E,{separator:"/"},{default:b(()=>[(h(!0),M(te,null,le(p(i),(n,q)=>(h(),z(u,{key:q},{default:b(()=>[V(C(n.name),1)]),_:2},1024))),128))]),_:1})])):ne("",!0),K("div",De,[(h(!0),M(te,null,le(p(r).filter(n=>!p(c)||(n.filename||n.foldername).includes(p(c))),(n,q)=>(h(),M("div",{onDblclick:I=>T(q,n),onContextmenu:U(I=>W(I,q),["prevent","stop"]),class:"pages-list-files-item",key:q,id:n.fileid||n.folderid},[K("i",{"data-fileid":n.fileid,"data-filename":n.filename,"data-filesuffix":n.suffix||n.filesuffix,class:fe(["iconfont",n.icon]),style:ce({color:F(n.suffix,n.type)})},null,14,Se),n.changeflag?(h(),z(ie,{key:1,ref_for:!0,ref_key:"inputRef",ref:y,onBlur:P,onKeydown:pe(j,["enter"]),modelValue:p(f),"onUpdate:modelValue":e[0]||(e[0]=I=>me(f)?f.value=I:f=I)},null,8,["modelValue"])):(h(),M(te,{key:0},[n.type==="folder"?(h(),M("span",{key:0,onDblclick:U(I=>D(n),["stop"])},C(n.foldername),41,Re)):(h(),M("span",{key:1,onDblclick:U(I=>D(n),["stop"])},C(n.filename+"."+n.suffix),41,Fe))],64))],40,Ie))),128))])])],32)}}},Te=ae($e,[["__scopeId","data-v-a40da4b6"]]);export{Te as default};
