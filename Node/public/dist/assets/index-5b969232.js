import{_ as z,r as x,w as j,a as _,o as m,c as k,b as e,d as u,e as d,u as g,s as Q,n as T,f as w,g as N,h as R,F as D,i as P,t as H,j as X,k as F,l as Y,m as V,p as A,q as ee,E as J,v as S,x as te,y as ne}from"./index-2dae8f78.js";import{C as se}from"./index-521af508.js";import{s as oe,c as ae}from"./index-4194ef73.js";import"./index-1adbd7d5.js";const ie={class:"aside"},le={class:"aside-search"},re={__name:"aside",props:{activeMenu:{type:String,default:"pages"}},setup(i){const c=x("");j(c,s=>N.commit("setSearchKeyWord",s));const o=s=>w.push(`/home/${s}`);return(s,t)=>{const p=_("el-icon"),a=_("el-input");return m(),k("div",ie,[t[13]||(t[13]=e("div",{class:"aside-logo"},[e("i",{class:"iconfont icon-circulation"}),e("span",{title:"多人协作编辑器"}," 多人协作编辑器 ")],-1)),e("div",le,[u(a,{placeholder:"搜索",modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=l=>c.value=l),clearable:""},{prefix:d(()=>[u(p,null,{default:d(()=>[u(g(Q))]),_:1})]),_:1},8,["modelValue"])]),e("div",{class:T(["aside-icon",{active:i.activeMenu==="pages"}]),onClick:t[1]||(t[1]=l=>o("pages"))},t[7]||(t[7]=[e("i",{class:"iconfont icon-shouye-zhihui"},null,-1),e("span",null," 首页 ",-1)]),2),e("div",{class:T(["aside-icon",{active:i.activeMenu==="news"}]),onClick:t[2]||(t[2]=l=>o("news"))},t[8]||(t[8]=[e("i",{class:"iconfont icon-zuijinchangyong"},null,-1),e("span",null," 最近文档 ",-1)]),2),e("div",{class:T(["aside-icon",{active:i.activeMenu==="share"}]),onClick:t[3]||(t[3]=l=>o("share"))},t[9]||(t[9]=[e("i",{class:"iconfont icon-shujugongxiang"},null,-1),e("span",null," 与我共享 ",-1)]),2),e("div",{class:T(["aside-icon",{active:i.activeMenu==="favor"}]),onClick:t[4]||(t[4]=l=>o("favor"))},t[10]||(t[10]=[e("i",{class:"iconfont icon-shoucang2"},null,-1),e("span",null," 我的收藏 ",-1)]),2),e("div",{class:T(["aside-icon",{active:i.activeMenu==="messageCentre"}]),onClick:t[5]||(t[5]=l=>o("messageCentre"))},t[11]||(t[11]=[e("i",{class:"iconfont icon-xiaoxizhongxin"},null,-1),e("span",null," 消息中心 ",-1)]),2),e("div",{class:"aside-bottom",onClick:t[6]||(t[6]=l=>g(w).push("/recycle"))},t[12]||(t[12]=[e("i",{class:"iconfont icon-huishouzhan"},null,-1),e("span",null," 回收站 ",-1)]))])}}},ce=z(re,[["__scopeId","data-v-0c7b257b"]]);const ue={style:{width:"100%",height:"100%"}},de={class:"dropdownItem"},pe=["title"],me={__name:"index",props:{trigger:{type:String,default:"click"},list:{type:Array,default:()=>[]}},emits:["handleCommand","handleOpen","handleClose"],setup(i,{emit:c}){const o=c,s=a=>o("handleCommand",a),t=()=>o("handleOpen"),p=()=>o("handleClose");return(a,l)=>{const h=_("el-dropdown-item"),f=_("el-dropdown-menu"),v=_("el-dropdown");return m(),R(v,{trigger:i.trigger,onHandleOpen:t,onHandleClose:p,onCommand:s},{dropdown:d(()=>[u(f,null,{default:d(()=>[(m(!0),k(D,null,P(i.list,C=>(m(),R(h,{key:C.command,command:C.command},{default:d(()=>[e("div",de,[e("i",{class:T(["iconfont",C.icon])},null,2),e("span",{title:C.name},H(C.name),9,pe)])]),_:2},1032,["command"]))),128))]),_:1})]),default:d(()=>[e("div",ue,[X(a.$slots,"content",{},void 0,!0)])]),_:3},8,["trigger"])}}},_e=z(me,[["__scopeId","data-v-d3abf79c"]]),fe=(i,c,o="Typora")=>new Promise((s,t)=>{if(i.name.split(".")[1]==="md"){let a=new FileReader;a.readAsText(i,"UTF-8"),a.onloadend=async l=>{l.target.readyState!==2&&t({msg:"文件读写失败"});let h=ge(l.target.result.toString().split(`
`)),{userid:f}=JSON.parse(sessionStorage.getItem("user")),v=await oe({fileid:c,userid:f,content:h});v.code!==200&&t(v),s(v)}}});function ge(i,c){let o=[];return i.forEach(s=>{let t=s&&s.match(/^[#]+|[*]+[\u4e00-\u9fa5|\d|a-z|A-Z|-]|[~~~]{3}|[<][u][>]|[\]][(]/g);if(!t)return o.push({insert:L(s)});let p=null;t.forEach(a=>{a.toString().includes("#")&&(p=a.length)}),o.push({insert:L(s),attributes:{header:p}})}),JSON.stringify(o)}function L(i){return i.replace(/[']/g,"#[d]#").replace(/["]/g,"#[s]#").replace(/^#+/g,"")}const ve={class:"top-left"},he={class:"top-right"},ye={class:"top-right-vip"},xe={class:"top-right-message",style:{"margin-right":"20px"}},we={class:"top-right-user"},Ce=["innerHTML"],be={key:2,class:"iconfont icon-tipvip"},ke={__name:"top",setup(i){const c=x("【双十一】超值活动，会员低至0.5元/天！");let o=x(!0),s=x("");const t=F([{name:"个人中心",command:"user",icon:"icon-zhanghao"},{name:"系统设置",command:"setting",icon:"icon-shezhi-xianxing"},{name:"项目地址",command:"gitee",icon:"icon-github-fill"},{name:"退出系统",command:"exit",icon:"icon-tuichu"}]),p=F({show:!1}),a=r=>{switch(r){case"user":w.push("/user");break;case"gitee":window.open("https://gitee.com/wfeng0/mpoe");break;case"setting":p.show=!0;break;case"exit":sessionStorage.clear(),w.push("/login");break}},l=()=>w.push("/template");let h=x(null),f=x(!1);const v=async r=>{f.value=!0,await ee(),h.value.showContentMenu(r,!0)},C=()=>f.value=!1,K=r=>N.commit("setTopCreateData",r);let B=x(null);const U=async r=>{const n=r.target.files[0];try{await J.confirm(`确认上传 ${n.name} 进行协同吗？`,"文件上传",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),W(n)}catch{S.info("已取消")}B.value.value=""},W=async r=>{let n=JSON.parse(sessionStorage.getItem("user")).userid,y=r.name.split(".")[0],b=r.name.split(".")[1],I={md:"markdown",txt:"txt",doc:"word",docx:"word",xls:"excel",xlsx:"excel"}[b],M=w.currentRoute.value.query.folderid,Z=Math.random().toString().split(".")[1].slice(0,3),$=await ae({userid:n,filename:y,filesuffix:b,filetype:I,fileownerfolderid:M});if($.code!==200)return S.error("导入失败，"+$.msg);S.success("文件导入成功！");let G={id:$.data,name:Z,suffix:b,type:I};N.commit("setTopCreateData",G);let O=await fe(r,$.data,"Typora");if(O.code!==200)return S.error(O.msg);S.success(O.msg);try{await J.confirm("是否立即打开文件？","打开文件",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"});let q={filename:y,filesuffix:b,filetype:I,owner:n};w.push({path:b==="xlsx"?`/excel/${$.data}`:`/edit/${$.data}`,query:q})}catch{S.info("已取消")}};return Y(()=>{let r=JSON.parse(sessionStorage.getItem("user"));o.value=r.vip,s.value=r.userimg}),(r,n)=>{const y=_("el-button"),b=_("el-link"),E=_("el-badge"),I=_("el-avatar");return m(),k("div",{class:"top",onClick:n[2]||(n[2]=V((...M)=>r.hiddenContentMenu&&r.hiddenContentMenu(...M),["stop"]))},[e("div",ve,[u(y,{type:"primary",onClick:n[0]||(n[0]=V(M=>v(M),["stop"]))},{default:d(()=>n[3]||(n[3]=[e("i",{class:"iconfont icon-xinjian"},null,-1),e("span",null,"新建",-1)])),_:1,__:[3]}),u(y,{text:"",onClick:n[1]||(n[1]=V(M=>g(B).click(),["stop"]))},{default:d(()=>n[4]||(n[4]=[e("i",{class:"iconfont icon-daoru"},null,-1),e("span",null,"导入",-1)])),_:1,__:[4]}),u(y,{text:"",onClick:l},{default:d(()=>n[5]||(n[5]=[e("i",{class:"iconfont icon-duqumoban"},null,-1),e("span",null,"模板",-1)])),_:1,__:[5]}),u(y,{text:""},{default:d(()=>n[6]||(n[6]=[e("i",{class:"iconfont icon-gongneng"},null,-1),e("span",null,"工具箱",-1)])),_:1,__:[6]})]),e("div",he,[e("div",ye,[u(b,{type:"danger"},{default:d(()=>[n[7]||(n[7]=e("i",{class:"iconfont icon-zuanshi"},null,-1)),e("span",null,H(c.value),1)]),_:1,__:[7]})]),e("div",xe,[u(E,{value:"",class:"item"},{default:d(()=>n[8]||(n[8]=[e("i",{class:"iconfont icon-xiaoxizhongxin"},null,-1)])),_:1,__:[8]})]),e("div",we,[u(_e,{list:t,onCommand:a},{content:d(()=>[g(s)?(m(),k("div",{key:0,class:"userimg_svg",innerHTML:g(s)},null,8,Ce)):(m(),R(I,{key:1,shape:"square",src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"})),g(o)?(m(),k("i",be)):A("",!0)]),_:1},8,["list"])])]),g(f)?(m(),R(se,{key:0,ref_key:"contentmenuRef",ref:h,onCreate:K,onClose:C},null,512)):A("",!0),e("input",{type:"file",onChange:U,style:{display:"none"},accept:"*",ref_key:"inputRef",ref:B},null,544)])}}},Me=z(ke,[["__scopeId","data-v-524b9165"]]);const $e={class:"home"},Se={class:"home-main"},Te={__name:"index",setup(i){let c=F([{title:"首页",path:"/home/pages"}]),o=[{path:"news",title:"最近文档"},{path:"share",title:"与我共享"},{path:"favor",title:"我的收藏"},{path:"messageCentre",title:"消息中心"}],s=x("pages");return j(w.currentRoute,t=>{let p=t.path.split("/")[2];s=p;let a=o.find(l=>l.path===p);c.length===1&&p==="pages"||(c.length>1&&c.pop(),a&&c.push({title:a.title,path:`/home/${a.path}`}))},{deep:!0,immediate:!0}),(t,p)=>{const a=_("el-breadcrumb-item"),l=_("el-breadcrumb"),h=_("router-view");return m(),k("div",$e,[u(ce,{activeMenu:g(s)},null,8,["activeMenu"]),e("div",Se,[u(Me),u(l,{class:"home-main-bread","separator-icon":g(ne)},{default:d(()=>[(m(!0),k(D,null,P(g(c),(f,v)=>(m(),R(a,{key:v,to:{path:f.path}},{default:d(()=>[te(H(f.title),1)]),_:2},1032,["to"]))),128))]),_:1},8,["separator-icon"]),u(h,{style:{flex:"auto",padding:"10px 20px"}})])])}}},Oe=z(Te,[["__scopeId","data-v-2c0ba73c"]]);export{Oe as default};
